\documentclass[main.tex]{subfiles}

\begin{document}

\chapter{Homological algebra in abelian categories}
\label{ch:homological_algebra_in_abelian_categories}

\section{Chain complexes}
\label{ssc:chain_complexes}

\begin{definition}[category of chain complexes]
  \label{def:category_of_chain_complexes_abelian}
  Let $\mathcal{A}$ be an abelian category. A \defn{chain complex} $C_{\bullet}$ in $\mathcal{A}$ is a collection of objects $C_{n} \in \mathcal{A}$, $n \in \Z$, together with morphisms $d_{n}\colon C_{n} \to C_{n-1}$ such that $d_{n-1} \circ d_{n} = 0$.

  The category of chain complexes in $\mathcal{A}$, denoted $\Ch(\mathcal{A})$, is the category whose objects are chain complexes and whose morphisms are morphisms $C_{\bullet} \to D_{\bullet}$ of chain complexes, i.e.\ for each $n \in \Z$ a map $f_{n}\colon C_{n} \to D_{n}$ such that all of the squares form commute.
  \begin{equation*}
    \begin{tikzcd}
      \cdots
      \arrow[r, "d^{C}_{n+2}"]
      & C_{n+1}
      \arrow[r, "d^{C}_{n+1}"]
      \arrow[d, "f_{n+1}"]
      & C_{n}
      \arrow[r, "d^{C}_{n}"]
      \arrow[d, "f_{n}"]
      & C_{n-1}
      \arrow[r, "d^{C}_{n-1}"]
      \arrow[d, "f_{n-1}"]
      & \cdots
      \\
      \cdots
      \arrow[r, "d^{D}_{n+2}"]
      & D_{n+1}
      \arrow[r, "d^{D}_{n+1}"]
      & D_{n}
      \arrow[r, "d^{D}_{n}"]
      & D_{n-1}
      \arrow[r, "d^{D}_{n-1}"]
      & \cdots
    \end{tikzcd}
  \end{equation*}

  We also define $\Ch^{+}(\mathcal{A})$ to be the category of \defn{bounded-below} chain complexes (i.e.\ the full subcategory consisting of chain complexes $C_{\bullet}$ such that $C_{n} = 0$ for small enough $n$), $\Ch^{-}(\mathcal{A})$ to be the category of \defn{bounded-above} chain complexes, and $\Ch^{\geq 0}(\mathcal{A})$ and $\Ch^{\leq 0}(\mathcal{A})$ similarly.
\end{definition}

\begin{theorem}
  \label{thm:category_of_chain_complexes_is_abelian}
  The category $\Ch(\mathcal{A})$ is abelian.
\end{theorem}
\begin{proof}
  We check each of the conditions.

  The zero object is the zero chain complex, the $\mathbf{Ab}$-enrichment is given level-wise, and the product is given level-wise as the direct sum. That this satisfies the universal property follows almost immediately from the universal property in $\mathcal{A}$: given a diagram of the form
  \begin{equation*}
    \begin{tikzcd}
      & Q_{\bullet}
      \arrow[dr, "g_{\bullet}"]
      \arrow[dl, swap, "f_{\bullet}"]
      \arrow[d, dashed, "\exists!\phi_{\bullet}"]
      \\
      C_{\bullet}
      & C_{\bullet} \times D_{\bullet}
      \arrow[r, swap, "p_{2}"]
      \arrow[l, "p_{1}"]
      & D_{\bullet}
    \end{tikzcd}
  \end{equation*}
  the only thing we need to check is that the map $\phi$ produced level-wise is really a chain map, i.e.\ that
  \begin{equation*}
    \phi_{n-1} \circ d_{n}^{Q} = d_{n}^{C} \oplus d_{n}^{D} \circ \phi_{n}.
  \end{equation*}
  By the above work, the RHS can be re-written as
  \begin{align*}
    (d^{C}_{n} \oplus d^{D}_{n}) \circ (i_{1} \circ f_{n-1} + i_{2} \circ g_{n-1}) &= i_{1} \circ d_{n}^{C} \circ f_{n} + i_{2} \circ d_{n}^{D} \circ g_{n} \\
    &= i_{1} \circ f_{n-1} \circ d^{Q}_{n} + i_{2} \circ g_{n-1} \circ d^{Q}_{n} \\
    &= (i_{1} \circ f_{n-1} + i_{2} \circ g_{n-1}) \circ d^{Q}_{n},
  \end{align*}
  which is equal to the LHS.

  The kernel is also defined level-wise. The standard diagram chase shows that the induced morphisms between kernels make this into a chain complex; to see that it satisfies the universal property, we need only show that the map $\phi$ below is a chain map.
  \begin{equation*}
    \begin{tikzcd}
      & Q_{\bullet}
      \arrow[dr, "0"]
      \arrow[d, "g_{\bullet}"]
      \arrow[dl, swap, dashed, "\phi_{\bullet}"]
      \\
      \ker(f_{\bullet})
      \arrow[r, "\iota_{\bullet}"]
      & A_{\bullet}
      \arrow[r, "f_{_{\bullet}}"]
      & B_{\bullet}
    \end{tikzcd}
  \end{equation*}
  That is, we must have
  \begin{equation}
    \label{eq:needstocommute}
    \phi_{n-1} \circ d^{Q}_{n} = d_{n}^{\ker f} \circ \phi_{n}.
  \end{equation}

  The composition
  \begin{equation*}
    \begin{tikzcd}
      Q_{n}
      \arrow[r, "g_{n}"]
      & A_{n}
      \arrow[r, "f"]
      & B_{n}
      \arrow[r, "d_{n}^{B}"]
      & B_{n-1}
    \end{tikzcd}
  \end{equation*}
  gives zero by assumption, giving us by the universal property for kernels a unique map
  \begin{equation*}
    \psi\colon Q_{n} \to \ker f_{n-1}
  \end{equation*}
  such that
  \begin{equation*}
    \iota_{n-1} \circ \psi = d^{A}_{n} \circ g_{n}.
  \end{equation*}
  We will be done if we can show that both sides of \hyperref[eq:needstocommute]{Equation~\ref*{eq:needstocommute}} can play the role of $\psi$. Plugging in the LHS, we have
  \begin{align*}
    \iota_{n-1} \circ \phi_{n-1} \circ d^{Q}_{n} &= g_{n-1} \circ d^{Q}_{n} \\
    &= d^{A}_{n} \circ g_{n}
  \end{align*}
  as we wanted. Plugging in the RHS we have
  \begin{equation*}
    \iota_{n-1} \circ d^{\ker f}_{n} \circ \phi_{n} = d^{A}_{n} \circ g_{n}.
  \end{equation*}

  The case of cokernels is dual.

  Since a chain map is a monomorphism (resp. epimorphism) if and only if it is a monomorphism (resp. epimorphism), we have immediately that monomorphisms are the kernels of their cokernels, and epimorphisms are the cokernels of their kernels.
\end{proof}

The categories $\Ch^{+}(\mathcal{A})$, etc., are also abelian.

\section{Homology}
\label{sec:homology}

We would like to replicate the notion of the homology of a chain complex $C_{\bullet}$ in the context of abelian categories.
\begin{equation*}
  \begin{tikzcd}
    \cdots
    \arrow[r, "d_{n+2}"]
    & C_{n+1}
    \arrow[r, "d_{n+1}"]
    & C_{n}
    \arrow[r, "d_{n}"]
    & C_{n_1}
    \arrow[r, "d_{n-1}"]
    & \cdots
  \end{tikzcd}
\end{equation*}
This will mean finding appropriate notions of every symbol appearing in the equation.
\begin{equation*}
  H_{n}(C_{\bullet}) = \frac{\ker d_{n}}{\im d_{n+1}}.
\end{equation*}

We already have a notion of the kernel, which we can use to define a notion of the image in the following way. Given a map $f\colon A \to B$, we heuristically think of the cokernel of $f$ as being $B/\im f$. Thus, taking the kernel of the cokernel should give us the image of $f$.

\begin{definition}[image]
  \label{def:image}
  Given a morphism $f\colon A \to B$, the \defn{image} of $f$ is $\im f = \ker\coker f$. 
\end{definition}

Now we need to figure out what it means to quotient the image of one map by the kernel of the next. Again, the cokernel saves our necks; we just need a map from $\im d_{n+1}$ into $\ker d_{n}$. The homology will be the cokernel of this map.

\begin{definition}[homology]
  \label{def:homology}
  Let
  \begin{equation*}
    \begin{tikzcd}
      A
      \arrow[r, "f"]
      & B
      \arrow[r, "g"]
      & C
    \end{tikzcd}
  \end{equation*}
  be morphisms such that $g \circ f = 0$. Using the universal properties of the kernel and cokernel, we can build the following commutative diagram.
  \begin{equation*}
    \begin{tikzcd}
      & \im f
      \arrow[d, hook, "i"]
      \arrow[dr, "0"]
      \\
      A
      \arrow[r, "f"]
      & B
      \arrow[r, "g"]
      \arrow[d, two heads, "p"]
      & C
      \\
      & \coker f
      \arrow[ur]
    \end{tikzcd}
  \end{equation*}
  Since $g \circ i = 0$, $i$ factors through $\ker g$, giving us a monomorphism $\phi\colon \im f \to \ker g$.
  \begin{equation*}
    \begin{tikzcd}[column sep=small]
      & \im f
      \arrow[dr, hook, "i"]
      \arrow[r, hook, "\phi"]
      & \ker g
      \arrow[d, hook]
      \arrow[r, two heads]
      & H_{n}
      \\
      A
      \arrow[rr, "f"]
      && B
      \arrow[rr, "g"]
      \arrow[d, two heads, "p"]
      && C
      \\
      && \coker f
      \arrow[urr]
    \end{tikzcd}
  \end{equation*}

  The \defn{homology} of the sequence $A \to B \to C$ at $B$ is then $H_{n} = \coker \phi$.
\end{definition}

\begin{definition}[exact sequence]
  \label{def:exact_sequence_abelian}
  Let
  \begin{equation*}
    \begin{tikzcd}
      A_{1}
      \arrow[r, "f_{1}"]
      & A_{2}
      \arrow[r, "f_{2}"]
      & \cdots
      \arrow[r, "f_{n-1}"]
      & A_{n}
    \end{tikzcd}
  \end{equation*}
  be objects and morphisms in an abelian category. We say that the above sequence is \defn{exact} if $\phi_{i}$ is an isomorphism, i.e.\ if the homology is zero. We say that a complex $(C_{\bullet}, d)$ is \defn{exact} if it is exact at all positions.

  A \defn{short exact sequence} is an exact sequence of the form
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & A
      \arrow[r]
      & B
      \arrow[r]
      & C
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
\end{definition}

\begin{proposition}
  Homology extends to a family of additive functors
  \begin{equation*}
    H_{n}\colon \Ch(\mathcal{A}) \to \mathcal{A}.
  \end{equation*}
\end{proposition}
\begin{proof}
  We need to define $H_{n}$ on morphisms. To this end, let $f_{\bullet}\colon C_{\bullet} \to D_{\bullet}$ be a morphism of chain complexes.
  \begin{equation*}
    \begin{tikzcd}
      C_{n+1}
      \arrow[r, "d^{C}_{n+1}"]
      \arrow[d, swap, "f_{n+1}"]
      & C_{n}
      \arrow[r, "d^{C}_{n}"]
      \arrow[d, "f_{n}"]
      & C_{n-1}
      \arrow[d, "f_{n-1}"]
      \\
      D_{n+1}
      \arrow[r, swap, "d^{D}_{n+1}"]
      & D_{n}
      \arrow[r, swap, "d^{D}_{n}"]
      & D_{n-1}
    \end{tikzcd}
  \end{equation*}
  We need a map $H_{n}(C_{\bullet}) \to H_{n}(D_{\bullet})$. This will come from a map $\ker d^{C}_{n} \to \ker d^{D}_{n}$. In fact, $f_{n}$ gives us such a map, essentially by restriction. We need to show that this descends to a map between cokernels.
\end{proof}

We can also go the other way, by defining a map
\begin{equation*}
  \iota_{n}\colon \mathcal{A} \to \Ch(\mathcal{A})
\end{equation*}
which sends an object $A$ to the chain complex
\begin{equation*}
  \begin{tikzcd}
    &{\ }
    \arrow[r, dotted]
    & 0
    \arrow[r]
    & A
    \arrow[r]
    & 0
    \arrow[r, dotted]
    &{\ }
  \end{tikzcd}
\end{equation*}
concentrated in degree $n$.

\begin{example}
  \label{eg:compute_homology_in_trivial_situation}
  In some situations, homology is easy to compute explicitly. Let
  \begin{equation*}
    \begin{tikzcd}
      \cdots
      \arrow[r]
      & C_{1}
      \arrow[r, "f"]
      & C_{0}
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  be a chain complex in $\Ch_{\geq 0}(\mathcal{A})$. Then $H_{0}(C_{\bullet}) = \coker f$.

  Similarly, if
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & C_{0}
      \arrow[r, "f"]
      & C_{-1}
      \arrow[r]
      & \cdots
    \end{tikzcd}
  \end{equation*}
  is a chain complex in $\Ch_{\leq 0}(\mathcal{A})$, then $H_{0}(C_{\bullet}) = \ker f$.
\end{example}

\section{Diagram lemmas}
\label{sec:diagram_lemmas}

\subsection{The splitting lemma}
\label{ssc:the_splitting_lemma}

\begin{lemma}[Splitting lemma]
  \label{lemma:splitting_lemma}
  Consider the following solid short exact sequence in an abelian category $\mathcal{A}$.
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & A
      \arrow[r, "i_{A}"]
      & B
      \arrow[r, "\pi_{C}"]
      \arrow[l, bend left, dashed, "\pi_{A}"]
      & C
      \arrow[r]
      \arrow[l, bend left, dashed, "i_{C}"]
      & 0
    \end{tikzcd}
  \end{equation*}
  The following are equivalent.
  \begin{enumerate}
    \item The sequence \emph{splits from the left,} i.e.\ there exists a morphism $\pi_{A}\colon B \to A$ such that $\pi_{A} \circ i_{A} = \id_{A}$

    \item The sequence \emph{splits from the right,} i.e.\ there exists a morphism $i_{C}\colon C \to B$ such that $\pi_{C} \circ i_{C} = \id_{C}$

    \item $B$ is a direct sum $A \oplus C$ with the obvious canonical injections and projections.
  \end{enumerate}
\end{lemma}
\begin{proof}
  That $3 \Rightarrow 1$ and $3 \Rightarrow 2$ is obvious. We now show that $1 \Rightarrow 2$.

  By exactness, $i_{A}\colon A \to B$ is a kernel of $\pi_{C}$. Consider the map $\phi = \id_{B} - i_{C} \circ \pi_{C}$. Since
  \begin{align*}
    \pi_{C} \circ \phi &= \pi_{C} - \pi_{C} \circ i_{C} \circ \pi_{C} \\
    &= \pi_{C} - \id \circ \pi_{C} \\
    &= 0,
  \end{align*}
  the universal property for the kernel guarantees us a map $\psi\colon B \to A$ such that $i_{A} \circ \psi = \phi$.

  Now we use the same universal property in a different situation. Consider the following diagram.
  \begin{equation*}
    \begin{tikzcd}
      & A
      \arrow[d, "i_{A}"]
      \arrow[dl, dashed]
      \arrow[dr, "0"]
      \\
      A
      \arrow[r, "i_{A}"]
      & B
      \arrow[r, "\pi_{C}"]
      & C
    \end{tikzcd}
  \end{equation*}
  The universal property guarantees us a unique dashed map making everything commute. But $\id_{A}$ and $i_{A} \circ \psi$ both do the job since
  \begin{align*}
    i_{A} \circ \psi \circ i_{A} &= i_{A} - i_{C} \circ \pi_{C} \circ i_{A} \\
    &= i_{A}.
  \end{align*}
\end{proof}

\subsection{The snake lemma}
\label{ssc:the_snake_lemma}

\begin{lemma}
  Given a square
  \begin{equation*}
    \begin{tikzcd}
      A
      \arrow[r, "f"]
      \arrow[d, swap, "g"]
      & B
      \arrow[d, "h"]
      \\
      C
      \arrow[r, "k"]
      & D
    \end{tikzcd}
  \end{equation*}
  in any abelian category, consider the sequence
  \begin{equation*}
    \begin{tikzcd}
      A
      \arrow[r, "{(f, -g)}"]
      & B \oplus C
      \arrow[r, "{(h, k)}"]
      & D
    \end{tikzcd}.
  \end{equation*}
  We have the following results.
  \begin{enumerate}
    \item The composition $(h, k) \circ (f, -g) = 0$ if and only if the square commutes.

    \item The morphism $(f, -g) = \ker(h, k)$ if and only if the square is a pullback.

    \item The morphism $(h, k) = \coker(f, -g)$ if and only if the square is a pushout.
  \end{enumerate}
\end{lemma}
\begin{proof}
  \leavevmode
  \begin{enumerate}
    \item Obvious.

    \item 
  \end{enumerate}
\end{proof}

\begin{lemma}
  Let $f\colon A \to C$ be an epimorphism, and let $g\colon B \to C$ be any morphism. Then $(f, g)\colon A \oplus B \to C$ is an epimorphism.
\end{lemma}
\begin{proof}
  Let $\alpha\colon C \to Z$ such that $\alpha \circ (f, g) = 0$. Consider the following diagram.
  \begin{equation*}
    \begin{tikzcd}
      A
      \arrow[r, hook, "i_{A}"]
      \arrow[dr, swap, two heads, "f"]
      \arrow[ddr, bend right, swap, "\alpha \circ f"]
      & A \oplus B
      \arrow[d, "{(f, g)}"]
      & B
      \arrow[dl, "g"]
      \arrow[l, hook, swap, "i_{C}"]
      \arrow[ddl, bend left, "\alpha \circ g"]
      \\
      & C
      \arrow[d, "\alpha"]
      \\
      & Z
    \end{tikzcd}
  \end{equation*}
  We need to show that $\alpha = 0$. Certainly, we have that
  \begin{equation*}
    \alpha \circ (f, g) \circ \iota_{A} = 0.
  \end{equation*}
  But this means that $\alpha \circ f = 0$; since $f$ is an epimorphism this means that $\alpha = 0$.
\end{proof}

\begin{lemma}
  \label{lemma:pullback_of_epi_is_epi}
  Let $\mathcal{A}$ be an abelian category, and let the diagram
  \begin{equation*}
    \begin{tikzcd}
      A \times_{C} B
      \arrow[r, "f"]
      \arrow[d, swap, "g"]
      & B
      \arrow[d, "h"]
      \\
      A
      \arrow[r, two heads, "k"]
      & C
    \end{tikzcd}
  \end{equation*}
  be a pullback in $\mathcal{A}$. Then $f$ is an epimorphism.
\end{lemma}
\begin{proof}
  Since the above square is a pullback, the morphism $(f, -g) = \ker (h, k)$. But $(h, k)$ is an epimorphism, so it is the cokernel of its kernel, implying that the square is also a pushout square. Since pushouts reflect epimorphisms, $f$ is an epimorphism.
\end{proof}

\begin{lemma}
  \label{lemma:pullback_preserves_kernel}
  Let $f\colon B \twoheadrightarrow C$ be an epimorphism, and let $g\colon D \to C$ be any morphism. Then the kernel of $f$ functions as the kernel of the pullback of $f$ along $g$, in the sense that we have the following commuting diagram in which the right-hand square is a pullback square.
  \begin{equation*}
    \begin{tikzcd}
      \ker f'
      \arrow[d, equals]
      \arrow[r, "i"]
      & S
      \arrow[dr, phantom, "\ulcorner", very near start]
      \arrow[r, "f'"]
      \arrow[d, swap, "g'"]
      & D
      \arrow[d, "g"]
      \\
      \ker f
      \arrow[r, swap, "\iota"]
      & B
      \arrow[r, twoheadrightarrow, swap, "f"]
      & C
    \end{tikzcd}
  \end{equation*}
\end{lemma}
\begin{proof}
  Consider the following pullback square, where $f$ is an epimorphism.
  \begin{equation*}
    \begin{tikzcd}
      S
      \arrow[r, "f'"]
      \arrow[d, swap, "g'"]
      \arrow[dr, phantom, "\ulcorner", very near start]
      & D
      \arrow[d, "g"]
      \\
      B
      \arrow[r, twoheadrightarrow, swap, "f"]
      & C
    \end{tikzcd}
  \end{equation*}
  By \hyperref[lemma:pullback_of_epi_is_epi]{Lemma~\ref*{lemma:pullback_of_epi_is_epi}} the pullback $f'$ is also an epimorphism. Denote the kernel of $f$ by $K$.

  The claim is that $K$ is also a kernel of $f'$.
    %\begin{equation*}
    %  \begin{tikzcd}
    %    & S
    %    \arrow[r, "f'"]
    %    \arrow[d, swap, "g'"]
    %    & D
    %    \arrow[d, "g"]
    %    \\
    %    K
    %    \arrow[r, hookrightarrow, "\iota"]
    %    & B
    %    \arrow[r, twoheadrightarrow, swap, "f"]
    %    & C
    %  \end{tikzcd}
    %\end{equation*}
  Of course, in order for this statement to make sense we need a map $i\colon K \to S$. This is given to us by the universal property of the pullback as follows.
  \begin{equation*}
    \begin{tikzcd}
      K
      \arrow[drr, bend left, "0"]
      \arrow[ddr, bend right, swap, "\iota"]
      \arrow[dr, dashed, "\exists!i"]
      \\
      & S
      \arrow[r]
      \arrow[d]
      & D
      \arrow[d, "g"]
      \\
      & B
      \arrow[r, twoheadrightarrow, swap, "f"]
      & C
    \end{tikzcd}
  \end{equation*}
  Next we need to verify that $(K, i)$ is actually the kernel of $f'$, i.e.\ satisfies the universal property. To this end, let $v\colon Q \to S$ be a map such that $f' \circ v = 0$. We need to find a unique factorization of $v$ through $K$.
  \begin{equation*}
    \begin{tikzcd}
      & Q
      \arrow[dr, "0"]
      \arrow[d, "v"]
      \arrow[dl, swap, dashed, "\exists! v'"]
      \\
      K
      \arrow[r, "i"]
      \arrow[dr, swap, "\iota"]
      & S
      \arrow[r, twoheadrightarrow, swap, "f'"]
      \arrow[d, "g'"]
      & D
      \arrow[d, "g"]
      \\
      & B
      \arrow[r, swap, "f"]
      & C
    \end{tikzcd}
  \end{equation*}
  By definition $f' \circ v = 0$. Thus,
  \begin{align*}
    f \circ g' \circ v &= g \circ f' \circ v \\
    &= g \circ 0 \\
    &= 0,
  \end{align*}
  so $g' \circ v$ factors uniquely through $K$ as $g' \circ v = \iota \circ v'$. It remains only to check that the triangle formed by $v'$ commutes, i.e.\ $v = v' \circ i$. To see this, consider the following diagram, where the bottom right square is the pullback from before.
  \begin{equation*}
    \begin{tikzcd}
      Q
      \arrow[drr, bend left, "0"]
      \arrow[ddr, bend right, swap, "g' \circ v"]
      \arrow[dr, dashed, "\exists!"]
      \\
      & S
      \arrow[r, swap, "f'"]
      \arrow[d, "g'"]
      & D
      \arrow[d, "g"]
      \\
      & B
      \arrow[r, swap, "f"]
      & C
    \end{tikzcd}
  \end{equation*}
  By the universal property, there exists a unique map $Q \to S$ making this diagram commute. However, both $v$ and $i \circ v'$ work, so $v = i \circ v'$.

  Thus we have shown that, in a precise sense, the kernel of an epimorphism functions as the kernel of its pullback, and we have the following commutative diagram, where the right hand square is a pullback.
  \begin{equation*}
    \begin{tikzcd}
      \ker f'
      \arrow[d, equals]
      \arrow[r, "i"]
      & S
      \arrow[r, "f'"]
      \arrow[d, "g'"]
      & D
      \arrow[d, "g"]
      \\
      \ker f
      \arrow[r, swap, "\iota"]
      & B
      \arrow[r, twoheadrightarrow, swap, "f"]
      & C
    \end{tikzcd}
  \end{equation*}
\end{proof}
At least in the case that $g$ is mono, when phrased in terms of elements, this result is more or less obvious; we can imagine the diagram above as follows.
\begin{equation*}
  \begin{tikzcd}
    \left\{ \substack{\text{elements of pullback}\\\text{which map to $0$}} \right\}
    \arrow[r, hookrightarrow]
    \arrow[d, equals]
    & \left\{ \substack{\text{elements of $B$}\\\text{which map to $D$}} \right\}
    \arrow[r, twoheadrightarrow]
    \arrow[d, hookrightarrow]
    & D
    \arrow[d, hookrightarrow]
    \\
    \left\{ \substack{\text{elements of $B$}\\\text{which map to $0$}} \right\}
    \arrow[r, hookrightarrow]
    & B
    \arrow[r, twoheadrightarrow]
    & C
  \end{tikzcd}
\end{equation*}

\begin{theorem}[snake lemma]
  \label{thm:snake_lemma}
  Consider the following commutative diagram with exact rows.
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & A
      \arrow[d, swap, "f"]
      \arrow[r, "m"]
      & B
      \arrow[r, "e"]
      \arrow[d, swap, "g"]
      & C
      \arrow[r]
      \arrow[d, "h"]
      & 0
      \\
      0
      \arrow[r]
      & A'
      \arrow[r, "m'"]
      & B'
      \arrow[r, "e'"]
      & C'
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  This gives us an exact sequence
  \begin{equation*}
    0 \to \ker f \to \ker g \to \ker h \to \coker f \to \coker g \to \coker h \to 0.
  \end{equation*}
\end{theorem}
\begin{proof}
  We provide running commentary on the diagram below.
  \begin{equation}
    \label{eq:snakelemma}
    \begin{tikzcd}
      0
      \arrow[r, dotted]
      & \ker f
      \arrow[r, dotted]
      \arrow[d, hookrightarrow]
      & \ker g
      \arrow[r, dotted]
      \arrow[d, hookrightarrow]
      & \ker h
      \arrow[d, hookrightarrow]
      \\
      0
      \arrow[r]
      & A
      \arrow[r, hookrightarrow, "m"]
      \arrow[d, swap, "f"]
      & B
      \arrow[r, twoheadrightarrow, "e"]
      \arrow[d, swap, "g"]
      & C
      \arrow[r]
      \arrow[d, swap, "h"]
      & 0
      \\
      0
      \arrow[r]
      & A'
      \arrow[r, hookrightarrow, swap, "m'"]
      \arrow[d, twoheadrightarrow]
      & B'
      \arrow[r, twoheadrightarrow, swap, "e'"]
      \arrow[d, twoheadrightarrow]
      & C'
      \arrow[d, twoheadrightarrow]
      \arrow[r]
      & 0
      \\
      & \coker f
      \arrow[r, dotted]
      \arrow[from=uuurr, out=-22, in=157, looseness=1.5, overlay, dashed]
      & \coker g
      \arrow[r, dotted]
      & \coker h
      \arrow[r, dotted]
      & 0
    \end{tikzcd}
  \end{equation}

  We will see why the dotted portions are exact later.

  The only thing left is to define the dashed connecting homomorphism, and to prove exactness at $\ker h$ and $\coker f$.

    %We define the connecting homomorphism using elements, which is justified by the Freyd-Mitchell embedding theorem.
    %
    %Let $c \in \ker h$. By exactness at $C$, we can find a preimage under $ m$, which we will call $b$. We map this to $B'$ with $g$. It may seem that we are now out of luck since $e'$ is not surjective, but not to worry---applying $ m'$ we find that
    %\begin{equation*}
    %   m'(g(b)) = h( m(b)) = 0,
    %\end{equation*}
    %since $b \in \ker  m$. Thus,
    %\begin{equation*}
    %  g(b) \in \ker m' = \im e',
    %\end{equation*}
    %so we get a (unique!) preimage $a \in A'$. We send this to its image in $\coker f$.
    %\begin{equation*}
    %  \begin{tikzcd}
    %    && c
    %    \arrow[d, mapsto]
    %    \\
    %    & b
    %    \arrow[d, mapsto, "g"]
    %    & c
    %    \arrow[l, mapsto, swap, " m^{-1}"]
    %    \\
    %    a
    %    \arrow[d, mapsto]
    %    & g(b)
    %    \arrow[l, mapsto, "e'^{-1}"]
    %    \\
    %    {[a]}
    %  \end{tikzcd}
    %\end{equation*}

    %At first glance, this is not well-defined; we made a choice in picking $b$. However, it turns out that this choice doesn't matter, since the elements of $A$ we get from two different choices differ only by an element of the image of $f$, and thus are sent to the same element of the cokernel.
    %
    %To see this, suppose we had picked $b'$ such that $m'(b') = c$. Then certainly
    %\begin{equation*}
    %  m'(b - b') = c - c = 0,
    %\end{equation*}
    %so there is an $\tilde{a} \in A'$ such that
    %\begin{equation*}
    %  e'(\tilde{a}) = b - b'.
    %\end{equation*}
    %Define $a' = a-$

  Extract from the data of \hyperref[eq:snakelemma]{Diagram~\ref*{eq:snakelemma}} the following diagram.
  \begin{equation*}
    \begin{tikzcd}
      && \ker h
      \arrow[d, hookrightarrow]
      \\
      A
      \arrow[d, swap, "f"]
      \arrow[r, hookrightarrow, "m"]
      & B
      \arrow[r, twoheadrightarrow, "e"]
      \arrow[d, "g"]
      & C
      \arrow[d, "h"]
      \\
      A'
      \arrow[r, hookrightarrow, swap, "m'"]
      \arrow[d, twoheadrightarrow]
      & B'
      \arrow[r, swap, twoheadrightarrow, "e'"]
      & C'
      \\
      \coker f
    \end{tikzcd}
  \end{equation*}
  Take a pullback and a pushout, and using \hyperref[lemma:pullback_preserves_kernel]{Lemma~\ref*{lemma:pullback_preserves_kernel}} (and its dual), we find the following.
  \begin{equation*}
    \begin{tikzcd}
      \ker u
      \arrow[r, hookrightarrow, "a"]
      \arrow[d, equals]
      & S
      \arrow[r, twoheadrightarrow, "u"]
      \arrow[d, "r"]
      & \ker h
      \arrow[d, hookrightarrow]
      \\
      A
      \arrow[d, swap, "f"]
      \arrow[r, hookrightarrow, "m"]
      & B
      \arrow[r, twoheadrightarrow, "e"]
      \arrow[d, "g"]
      & C
      \arrow[d, "h"]
      \\
      A'
      \arrow[r, hookrightarrow, "m'"]
      \arrow[d, twoheadrightarrow]
      & B'
      \arrow[r, twoheadrightarrow, "e'"]
      \arrow[d, "s"]
      & C'
      \arrow[d, equals]
      \\
      \coker f
      \arrow[r, hookrightarrow, swap, "v"]
      & T
      \arrow[r, twoheadrightarrow, swap, "b"]
      & \coker v
    \end{tikzcd}
  \end{equation*}
  Consider the map
  \begin{equation*}
    \delta_{0} =
    \begin{tikzcd}
      S
      \arrow[r, "r"]
      & B
      \arrow[r, "g"]
      & B'
      \arrow[r, "s"]
      & T
    \end{tikzcd}.
  \end{equation*}

  By commutativity, $\delta \circ a = 0$, hence we get a map
  \begin{equation*}
    \delta_{1}\colon \ker h \to T.
  \end{equation*}
  Composing this with $b$ gives $0$, hence we get a map
  \begin{equation*}
    \delta\colon \coker f \to \ker h.
  \end{equation*}
\end{proof}

There is another version of the snake lemma which does not have the first and last zeroes.
\begin{theorem}[snake lemma II]
  \label{thm:snake_lemma_ii}
  Given the following commutative diagram with exact rows,
  \begin{equation*}
    \begin{tikzcd}
      & A
      \arrow[d, swap, "f"]
      \arrow[r, "m"]
      & B
      \arrow[r, "e"]
      \arrow[d, swap, "g"]
      & C
      \arrow[r]
      \arrow[d, "h"]
      & 0
      \\
      0
      \arrow[r]
      & A'
      \arrow[r, "m'"]
      & B'
      \arrow[r, "e'"]
      & C'
    \end{tikzcd}
  \end{equation*}
  we get a exact sequence
  \begin{equation*}
    \ker f \to \ker g \to \ker h \to \coker f \to \coker g \to \coker h.
  \end{equation*}
\end{theorem}

\subsection{The long exact sequence on homology}
\label{ssc:the_long_exact_sequence_on_homology}

\begin{corollary}
  \label{cor:long_exact_sequence_on_homology}
  Given an exact sequence of complexes
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & A_{\bullet}
      \arrow[r, "f_{\bullet}"]
      & B_{\bullet}
      \arrow[r, "g_{\bullet}"]
      & C_{\bullet}
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  we get a long exact sequence on homology
  \begin{equation*}
    \begin{tikzcd}
      & \cdots
      \arrow[r]
      & H_{n+1}(C)
      \\
      H_{n}(A)
      \arrow[from=urr, out=-22, in=157, looseness=1, overlay, "\delta" description]
      \arrow[r, "H_{n}(f)"]
      & H_{n}(B)
      \arrow[r, "H_{n}(g)"]
      & H_{n}(C)
      \\
      H_{n-1}(A)
      \arrow[from=urr, out=-22, in=157, looseness=1, overlay, "\delta" description]
      \arrow[r, "H_{n-1}(f)"]
      & H_{n-1}(B)
      \arrow[r, "H_{n-1}(g)"]
      & H_{n-1}(C)
      \\
      H_{n-2}(A)
      \arrow[from=urr, out=-22, in=157, looseness=1, overlay, "\delta" description]
      \arrow[r]
      & \cdots
    \end{tikzcd}
  \end{equation*}
\end{corollary}
\begin{proof}
  For each $n$, we have a diagram of the following form.
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & A_{n+1}
      \arrow[r]
      \arrow[d, swap, "d^{A}_{n+1}"]
      & B_{n+1}
      \arrow[r]
      \arrow[d, "d^{B}_{n+1}"]
      & C_{n+1}
      \arrow[r]
      \arrow[d, "d^{C}_{n+1}"]
      & 0
      \\
      0
      \arrow[r]
      & A_{n}
      \arrow[r]
      & B_{n}
      \arrow[r]
      & C_{n}
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  Applying the snake lemma (\hyperref[thm:snake_lemma]{Theorem~\ref*{thm:snake_lemma}}) gives us, for each $n$, two exact sequences as follows.
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & \ker d^{A}_{n+1}
      \arrow[r]
      & \ker d^{B}_{n+1}
      \arrow[r]
      & \ker d^{C}_{n+1}
    \end{tikzcd}
  \end{equation*}
  and
  \begin{equation*}
    \begin{tikzcd}
      \coker d^{A}_{n}
      \arrow[r]
      & \coker d^{B}_{n}
      \arrow[r]
      & \coker d^{C}_{n}
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}

  We can put these together in a diagram with exact rows as follows.
  \begin{equation*}
    \begin{tikzcd}
      & \coker d^{A}_{n}
      \arrow[r]
      & \coker d^{B}_{n}
      \arrow[r]
      & \coker d^{C}_{n}
      \arrow[r]
      & 0
      \\
      0
      \arrow[r]
      & \ker d^{A}_{n-1}
      \arrow[r]
      & \ker d^{B}_{n-1}
      \arrow[r]
      & \ker d^{C}_{n-1}
    \end{tikzcd}
  \end{equation*}
  Recall that for each $n$, we get a map
  \begin{equation*}
    \phi^{A}_{n-1}\colon \im d^{A}_{n-1} \to \ker d^{A}_{n},
  \end{equation*}
  and similarly for $B_{\bullet}$ and $C_{\bullet}$.

  Adding these in gives the following.
  \begin{equation*}
    \begin{tikzcd}
      & \coker d^{A}_{n}
      \arrow[r]
      \arrow[d]
      & \coker d^{B}_{n}
      \arrow[r]
      \arrow[d]
      & \coker d^{C}_{n}
      \arrow[r]
      \arrow[d]
      & 0
      \\
      0
      \arrow[r]
      & \ker d^{A}_{n-1}
      \arrow[r]
      & \ker d^{B}_{n-1}
      \arrow[r]
      & \ker d^{C}_{n-1}
    \end{tikzcd}
  \end{equation*}
  A second application of the snake lemma then gives a long exact sequence
  \begin{equation*}
    \begin{tikzcd}[column sep=small]
      \ker \phi_{f}
      \arrow[r]
      & \ker \phi_{g}
      \arrow[r]
      & \ker \phi_{h}
      \arrow[r]
      & \coker \phi_{f}
      \arrow[r]
      & \coker \phi_{g}
      \arrow[r]
      & \coker \phi_{h}
    \end{tikzcd}
  \end{equation*}
\end{proof}

\begin{lemma}
  \label{lemma:connecting_homomorphism_is_functorial}
  Let $\mathcal{A}$ be an abelian category, and let $f$ be a morphism of short exact sequences in $\Ch(\mathcal{A})$ as below.
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & A'_{\bullet}
      \arrow[r, "\alpha_{\bullet}"]
      \arrow[d, "f'_{\bullet}"]
      & A_{\bullet}
      \arrow[r, "\alpha'_{\bullet}"]
      \arrow[d, "f_{\bullet}"]
      & A''_{\bullet}
      \arrow[r]
      \arrow[d, "f''_{\bullet}"]
      & 0
      \\
      0
      \arrow[r]
      & B'_{\bullet}
      \arrow[r, swap, "\beta_{\bullet}"]
      & B_{\bullet}
      \arrow[r, swap, "\beta'_{\bullet}"]
      & B''_{\bullet}
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}

  This gives us the following morphism of long exact sequences on homology.
  \begin{equation*}
    \begin{tikzcd}
      \cdots
      \arrow[r]
      & H_{n}(A)
      \arrow[r, "H_{n}(\alpha')"]
      \arrow[d, swap, "H_{n}(f)"]
      & H_{n}(A'')
      \arrow[r, "\delta"]
      \arrow[d, "H_{n}(f'')"]
      & H_{n-1}(A')
      \arrow[r, "H_{n-1}(\alpha)"]
      \arrow[d, "H_{n}(f')"]
      & H_{n-1}(A)
      \arrow[d, "H_{n}(f)"]
      \arrow[r]
      & \cdots
      \\
      \cdots
      \arrow[r]
      & H_{n}(B)
      \arrow[r, "H_{n}(\beta')"]
      & H_{n}(B'')
      \arrow[r, "\delta"]
      & H_{n-1}(B')
      \arrow[r, "H_{n-1}(\beta)"]
      & H_{n-1}(B)
      \arrow[r]
      & \cdots
    \end{tikzcd}
  \end{equation*}
  In particular, the connecting morphism $\delta$ is functorial.
\end{lemma}

\subsection{The five lemma}
\label{ssc:the_five_lemma}

\begin{lemma}[four lemmas]
  \label{lemma:four_lemmas}
  \leavevmode
  \begin{enumerate}
    \item Let
      \begin{equation*}
        \begin{tikzcd}
          B
          \arrow[r]
          \arrow[d, two heads, swap, "b"]
          & C
          \arrow[r]
          \arrow[d, "c"]
          & D
          \arrow[r]
          \arrow[d, two heads, "d"]
          & E
          \arrow[d, hook, "e"]
          \\
          B'
          \arrow[r]
          & C'
          \arrow[r]
          & D'
          \arrow[r]
          & E'
        \end{tikzcd}
      \end{equation*}
      be a commutative diagram with exact rows, with monomorphisms and epimorphisms as marked. Then $c$ is an epimorphism.

    \item Let
      \begin{equation*}
        \begin{tikzcd}
          A
          \arrow[r]
          \arrow[d, two heads, swap, "a"]
          & B
          \arrow[r]
          \arrow[d, hook, "b"]
          & C
          \arrow[r]
          \arrow[d, "c"]
          & D
          \arrow[d, hook, "d"]
          \\
          A'
          \arrow[r]
          & B'
          \arrow[r]
          & C'
          \arrow[r]
          & D'
        \end{tikzcd}
      \end{equation*}
      be a commutative diagram with exact rows, with monomorphisms and epimorphisms as marked. Then $c$ is a monomorphism.
  \end{enumerate}
\end{lemma}
\begin{proof}
  \leavevmode
  \begin{enumerate}
    \item Expand the diagram with image-kernel factorization as follows.
      \begin{equation*}
        \begin{tikzcd}
          B
          \arrow[r, two heads]
          \arrow[d, two heads, "b"]
          & I_{1}
          \arrow[r, hook]
          \arrow[d, "i"]
          & C
          \arrow[r, two heads]
          \arrow[d, "c"]
          & I_{2}
          \arrow[r, hook]
          \arrow[d, "j"]
          & D
          \arrow[r, two heads]
          \arrow[d, two heads, "d"]
          & I_{3}
          \arrow[r, hook]
          \arrow[d, "k"]
          & E
          \arrow[d, hook, "e"]
          \\
          B'
          \arrow[r, two heads]
          & I_{1}'
          \arrow[r, hook]
          & C'
          \arrow[r, two heads]
          & I_{2}'
          \arrow[r, hook]
          & D'
          \arrow[r, two heads]
          & I_{3}'
          \arrow[r, hook]
          & E'
        \end{tikzcd}
      \end{equation*}
      It is immediate that $i$ is epi, and that $k$ is mono. Now, consider the following morphism of short exact sequences.
      \begin{equation*}
        \begin{tikzcd}
          0
          \arrow[r]
          & I_{2}
          \arrow[r, hook]
          \arrow[d, "j"]
          & D
          \arrow[r, two heads]
          \arrow[d, two heads, "d"]
          & I_{3}
          \arrow[r]
          \arrow[d, hook, "k"]
          & 0
          \\
          0
          \arrow[r]
          & I_{2}'
          \arrow[r, hook]
          & D'
          \arrow[r, two heads]
          & I_{3}'
          \arrow[r]
          & 0
        \end{tikzcd}
      \end{equation*}
      The snake lemma (\hyperref[thm:snake_lemma]{Theorem~\ref*{thm:snake_lemma}}) tells us that we have a short exact sequence
      \begin{equation*}
        \begin{tikzcd}
          0 = \ker k
          \arrow[r]
          & \coker j
          \arrow[r]
          & \coker d = 0,
        \end{tikzcd}
      \end{equation*}
      implying that $\coker j = 0$, i.e.\ that $j$ is epi.

      We have another morphism of short exact sequences.
      \begin{equation*}
        \begin{tikzcd}
          0
          \arrow[r]
          & I_{1}
          \arrow[r, hook]
          \arrow[d, two heads, "i"]
          & C
          \arrow[r, two heads]
          \arrow[d, "c"]
          & I_{2}
          \arrow[r]
          \arrow[d, two heads, "j"]
          & 0
          \\
          0
          \arrow[r]
          & I_{1}'
          \arrow[r, hook]
          & C'
          \arrow[r, two heads]
          & I_{2}'
          \arrow[r]
          & 0
        \end{tikzcd}
      \end{equation*}
      Using the information that $i$ and $j$ are epi, the snake lemma tells us that $j$ is epi as required.

    \item Dual.
  \end{enumerate}
\end{proof}
\begin{theorem}[five lemma]
  \label{thm:five_lemma}
  Let
  \begin{equation*}
    \begin{tikzcd}
      A
      \arrow[r]
      \arrow[d, two heads]
      & B
      \arrow[r]
      \arrow[d, "\cong"]
      & C
      \arrow[r]
      \arrow[d, "c"]
      & D
      \arrow[r]
      \arrow[d, "\cong"]
      & E
      \arrow[d, hook]
      \\
      A'
      \arrow[r]
      & B'
      \arrow[r]
      & C'
      \arrow[r]
      & D'
      \arrow[r]
      & E'
    \end{tikzcd}
  \end{equation*}
  be a commutative diagram with exact rows, with monomorphisms, epimorphisms, and isomorphisms as marked. Then $c$ is an isomorphism.
\end{theorem}
\begin{proof}
  The first part of \hyperref[lemma:four_lemmas]{Lemma~\ref*{lemma:four_lemmas}} tells us that $c$ is epi, and the second part tells us that $c$ is mono.
\end{proof}

\subsection{The nine lemma}
\label{ssc:the_nine_lemma}

\begin{theorem}[nine lemma]
  \label{thm:nine_lemma}
  Given the following commuting diagram whose rows are exact sequences,
  \begin{equation*}
    \begin{tikzcd}
      & 0
      \arrow[d]
      & 0
      \arrow[d]
      & 0
      \arrow[d]
      \\
      0
      \arrow[r]
      & A_{2}
      \arrow[r, hook]
      \arrow[d]
      & B_{2}
      \arrow[r, two heads, "p"]
      \arrow[d]
      & C_{2}
      \arrow[r]
      \arrow[d, "f"]
      & 0
      \\
      0
      \arrow[r]
      & A_{1}
      \arrow[r, hook]
      \arrow[d]
      & B_{1}
      \arrow[r, two heads]
      \arrow[d]
      & C_{1}
      \arrow[r]
      \arrow[d, "g"]
      & 0
      \\
      0
      \arrow[r]
      & A_{0}
      \arrow[r, hook]
      \arrow[d]
      & B_{0}
      \arrow[r, two heads]
      \arrow[d]
      & C_{0}
      \arrow[r]
      \arrow[d]
      & 0
      \\
      & 0
      & 0
      & 0
    \end{tikzcd}
  \end{equation*}
  we have the following results. Note that we do not assume that the columns are chain complexes.
  \begin{enumerate}
    \item If the first and the second columns $A_{\bullet}$ and $B_{\bullet}$ are exact sequences, then third column $C_{\bullet}$ is also an exact sequence.

    \item If $B_{\bullet}$ and $C_{\bullet}$ are exact sequence, then $A_{\bullet}$ is an exact sequence.

    \item If $A_{\bullet}$ and $C_{\bullet}$ are exact and $B_{\bullet}$ is a chain complex, then $B_{\bullet}$ is exact.
  \end{enumerate}
\end{theorem}
\begin{proof}
  \leavevmode
  \begin{enumerate}
    \item First, we show that $C_{\bullet}$ is a chain complex, i.e.\ that $g \circ f = 0$. Since $p$ is an epimorphism, it suffices to show that $g \circ f \circ p = 0$. But this is zero by commutativity of the diagram and the fact that $B_{\bullet}$ is a chain complex.

      Thus, the diagram above is a short exact sequence
      \begin{equation*}
        \begin{tikzcd}
          0
          \arrow[r]
          & A_{\bullet}
          \arrow[r, hook]
          & B_{\bullet}
          \arrow[r, two heads]
          & C_{\bullet}
          \arrow[r]
          & 0
        \end{tikzcd}
      \end{equation*}
      of chain complexes, and we get a long exact sequence on homology.
      \begin{equation*}
        \begin{tikzcd}
          && 0
          \\
          H_{2}(A_{\bullet})
          \arrow[from=urr, out=-22, in=157, looseness=1, overlay, "\delta" description]
          \arrow[r]
          & H_{2}(B_{\bullet})
          \arrow[r]
          & H_{2}(C_{\bullet})
          \\
          H_{1}(A_{\bullet})
          \arrow[from=urr, out=-22, in=157, looseness=1, overlay, "\delta" description]
          \arrow[r]
          & H_{1}(B_{\bullet})
          \arrow[r]
          & H_{1}(C_{\bullet})
          \\
          H_{0}(A_{\bullet})
          \arrow[from=urr, out=-22, in=157, looseness=1, overlay, "\delta" description]
          \arrow[r]
          & H_{0}(B_{\bullet})
          \arrow[r]
          & H_{0}(C_{\bullet})
          \\
          0
          \arrow[from=urr, out=-22, in=157, looseness=1, overlay, "\delta" description]
        \end{tikzcd}
      \end{equation*}

      If the first two columns are zeroes, then $H_{n}(C_{\bullet}) = 0$ by exactness; that is, $C_{\bullet}$ is exact.

    \item Formally dual.
      
    \item Identical.
  \end{enumerate}
\end{proof}

\section{Exact functors}
\label{sec:exact_functors}

\begin{definition}[exact functor]
  \label{def:exact_functor}
  Let $F\colon \mathcal{A} \to \mathcal{B}$ be a functor, and let
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & A
      \arrow[r, "f"]
      & B
      \arrow[r, "g"]
      & C
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  be an exact sequence. We use the following terminology.
  \begin{itemize}
    \item We call $F$ \defn{left exact} if
      \begin{equation*}
        \begin{tikzcd}
          0
          \arrow[r]
          & F(A)
          \arrow[r, "f"]
          & F(B)
          \arrow[r, "g"]
          & F(C)
        \end{tikzcd}
      \end{equation*}
      is exact.

    \item We call $F$ \defn{right exact} if
      \begin{equation*}
        \begin{tikzcd}
          F(A)
          \arrow[r, "f"]
          & F(B)
          \arrow[r, "g"]
          & F(C)
          \arrow[r]
          & 0
        \end{tikzcd}
      \end{equation*}
      is exact.

    \item We call $F$ \defn{exact} if it is both left exact and right exact.
  \end{itemize}
\end{definition}

\begin{example}
  Let
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & A
      \arrow[r, hookrightarrow, "f"]
      & B
      \arrow[r, twoheadrightarrow, "g"]
      & C
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  be an exact sequence. First, we show that $\Hom(M, -)$ is left exact, i.e.\ that
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & \Hom(M, A)
      \arrow[r, "f_{*}"]
      & \Hom(M, B)
      \arrow[r, "g_{*}"]
      & \Hom(M, C)
    \end{tikzcd}
  \end{equation*}
  is an exact sequence of abelian groups.

  First, we show that $f_{*}$ is injective. To see this, let $\alpha\colon M \to A$ such that $f_{*}(\alpha) = 0$. By definition, $f_{*}(\alpha) = f \circ \alpha$, and 
  \begin{equation*}
    f \circ \alpha = 0 \implies \alpha = 0
  \end{equation*}
  because $f$ is a monomorphism.

  Similarly, $\im f \subseteq \ker g$ because
  \begin{equation*}
    (g_{*} \circ f_{*})(\beta) = g \circ f \circ \beta = 0.
  \end{equation*}

  It remains only to check that $\ker g \subseteq \im f$. To this end, let $\gamma\colon M \to B$ such that $g_{*}\gamma = 0$.
  \begin{equation*}
    \begin{tikzcd}
      && M
      \arrow[d, swap, "\gamma"]
      \arrow[dr, "0"]
      \arrow[dl, swap, dashed, "\exists!\delta"]
      \\
      0
      \arrow[r]
      & A
      \arrow[r, hookrightarrow, "f"]
      & B
      \arrow[r, twoheadrightarrow, "g"]
      & C
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  Then $\im \gamma \subset \ker g = \im f$, so $\gamma$ factors through $A$; that is to say, there exists a $\delta\colon M \to A$ such that $f_{*}\delta = \gamma$.
\end{example}

One can also check that the functor $\Hom(-, B)$ is left exact via the same sort of arguments. However, we will see in the next section that one can make a much more general statement by relating left and right exactness to preservation of limits. The next theorem gives us a taste of this.

\begin{lemma}
  Let $F\colon \mathcal{A} \to \mathcal{B}$ be a functor between abelian categories which is either left or right exact. Then $F$ is additive, i.e.\ preserves finite (co)products.
\end{lemma}
\begin{proof}
  First, assume that $F$ is left exact. By \hyperref[cor:functor_additive_iff_preserves_direct_sums]{Corollary~\ref*{cor:functor_additive_iff_preserves_direct_sums}}, it suffices to show that $F$ preserves direct sums. To this end, consider the image of a split exact sequence under a left-exact functor $F$.
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & F(A)
      \arrow[r, "F(i_{A})"]
      & F(A \oplus B)
      \arrow[r, "F(\pi_{B})"]
      & F(B)
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  Because we still have the identities
  \begin{equation*}
    F(\pi_{A}) \circ F(i_{A}) = \id_{F(A)},\qquad F(\pi_{B}) \circ F(i_{B}) = \id_{F(B)},
  \end{equation*}
  the morphism $F(\pi_{B})$ is still epic; hence the splitting lemma (\hyperref[lemma:splitting_lemma]{Theorem~\ref*{lemma:splitting_lemma}}) implies that the sequence is still split exact. Thus, $F$ preserves direct sums.

  The case in which $F$ is right exact is dual.
\end{proof}

\subsection{Exactness and preservation of (co)limits}
\label{ssc:exactness_and_preservation_of_co_limits}

The above definitions of left and right exactness are evocative, but one can cast them in a more useful way. One starting point is to notice that they are related to the preservation of limits.

\begin{proposition}
  \label{prop:exact_if_preserve_limits_conditions}
  Let $F\colon \mathcal{A} \to \mathcal{B}$ be a functor between abelian categories.
  \begin{itemize}
    \item If $F$ preserves finite limits, then $F$ is left exact.

    \item If $F$ preserves finite colimits, then $F$ is right exact.
  \end{itemize}
\end{proposition}
\begin{proof}
  Let $f\colon A \to B$ be a morphism in an abelian category. The universal property for the kernel of $f$ is equivalent to the following: $(K, \iota)$ is a kernel of $f$ if and only if the following diagram is a pullback.
  \begin{equation*}
    \begin{tikzcd}
      K
      \arrow[r]
      \arrow[d, swap, "\iota"]
      & 0
      \arrow[d]
      \\
      A
      \arrow[r, swap, "f"]
      & B
    \end{tikzcd}
  \end{equation*}
  Any functor between abelian categories which preserves limits must in particular preserve pullbacks. Any such functor also sends initial objects to initial objects, and since initial objects are zero objects, such a functor preserves zero objects. Thus, any complete functor between abelian categories takes kernels to kernels.

  Dually, any functor which preserves colimits preserves cokernels.

  Next, note that the exactness of the sequence
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & A
      \arrow[r, "f"]
      & B
      \arrow[r, "g"]
      & C
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  is equivalent to the following three conditions.
  \begin{enumerate}
    \item Exactness at $A$ means that $f$ is mono, i.e.\ $0 \to A$ is a kernel of $f$.

    \item Exactness at $B$ means that $\im f = \ker g$.
      \begin{itemize}
        \item If $f$ is mono, this is equivalent to demanding that $(A, f)$ is a kernel of $g$.

        \item If $g$ is epi, this is equivalent to demanding that $(C, g)$ is a cokernel of $f$.
      \end{itemize}

    \item Exactness at $C$ means that $g$ is epi, i.e.\ $C \to 0$ is a cokernel of $g$.
  \end{enumerate}
\end{proof}

As may now be clear, the converse is also true; any functor which is left exact preserves finite limits, and any functor which is right exact preserves finite colimits.

\begin{proposition}
  Let $F\colon \mathcal{A} \to \mathcal{B}$ be a functor between abelian categories.
  \begin{itemize}
    \item If $F$ is left-exact, then $F$ preserves finite limits.

    \item If $F$ is right-exact, then $F$ preserves finite colimits.
  \end{itemize}
\end{proposition}
\begin{proof}
  Suppose $F$ is left exact. Then $F$ preserves kernels and products, hence all finite limits. If $F$ is right exact, then $F$ preserves all cokernels and coproducts, hence all finite colimits.
\end{proof}

Our definition of homology now allows us to cleanly note the following.
\begin{proposition}
  Exact functors preserve homology; that is, $H_{n}(F(C_{\bullet})) = F(H_{n}(C_{\bullet}))$.
\end{proposition}
\begin{proof}
  Exact functors preserve kernels and cokernels.
\end{proof}

\begin{example}
  \label{eg:kernels_and_cokernels_are_functorial}
  %The universal property for kernels is equivalent to the following: the kernel of $f\colon A \to B$ is the pullback of the following diagram.
  %\begin{equation*}
  %  \begin{tikzcd}
  %    \ker(f)
  %    \arrow[r, dashed]
  %    \arrow[d, dashed]
  %    & 0
  %    \arrow[d]
  %    \\
  %    A
  %    \arrow[r, "f"]
  %    & B
  %  \end{tikzcd}
  %\end{equation*}
  Consider the category $\mathcal{D}$ with objects and morphisms as follows.
  \begin{equation*}
    \begin{tikzcd}
      & \star
      \arrow[d]
      \\
      *
      \arrow[r]
      & \bullet
    \end{tikzcd}
  \end{equation*}
  Let $\mathcal{A}$ be an abelian category. By \hyperref[eg:examples_of_abelian_categories]{Example~\ref*{eg:examples_of_abelian_categories}}, the category of functors $\mathcal{D} \to \mathcal{A}$ is an abelian category.

  Consider a functor $\mathcal{D} \to \mathcal{A}$ which yields the following diagram in $\mathcal{A}$.
  \begin{equation*}
    \begin{tikzcd}
      & 0
      \arrow[d]
      \\
      A
      \arrow[r, "f"]
      & B
    \end{tikzcd}
  \end{equation*}
  Taking the pullback of the above diagram yields the kernel of $f$.

  A natural transformation $\phi$ between functors $\mathcal{D} \to \mathcal{A}$ consists of the data of a commuting square as follows.
  \begin{equation*}
    \begin{tikzcd}
      A
      \arrow[r, "f"]
      \arrow[d, swap, "\phi_{A}"]
      & B
      \arrow[d, "\phi_{B}"]
      \\
      A'
      \arrow[r, "f'"]
      & B'
    \end{tikzcd}
  \end{equation*}
  That is, we may view taking kernels as a functor from the category of morphisms in $\mathcal{A}$ to $\mathcal{A}$. Furthermore, because this functor is the result of a limiting procedure it preserves limits. Thus, given an exact sequence of morphisms in $\mathcal{A}$
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & A
      \arrow[r, hook]
      \arrow[d, swap, "f"]
      & B
      \arrow[r, two heads]
      \arrow[d, "g"]
      & C
      \arrow[r]
      \arrow[d, "h"]
      & 0
      \\
      0
      \arrow[r]
      & A
      \arrow[r, hook]
      & B
      \arrow[r, two heads]
      & C
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  one gets an exact sequence of kernels
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & \ker f
      \arrow[r, hook]
      & \ker g
      \arrow[r]
      & \ker h
    \end{tikzcd}.
  \end{equation*}

  Conversely, taking cokernels is cocomplete, hence right exact, so one has also an exact sequence of cokernels
  \begin{equation*}
    \begin{tikzcd}
      \coker f
      \arrow[r]
      & \coker g
      \arrow[r, two heads]
      & \coker h
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}

  Note that the data of a kernel 
\end{example}

\begin{example}
  Let $J$ be a filtered category, and let $\mathcal{A}$ be an abelian category. Then the category $\mathcal{A}^{J}$ is abelian (see \hyperref[eg:examples_of_abelian_categories]{Example~\ref*{eg:examples_of_abelian_categories}}).
\end{example}


\subsection{Exactness of the hom functor and tensor products}
\label{ssc:exactness_of_the_hom_functor_and_tensor_products}

We have already seen that the hom functor $\Hom_{\mathcal{A}}(-,-)$ is left exact in both slots. Now we understand precisely why this is true: the hom functor preserves limits in both slots!\footnote{In the first slot, one must take the limits in the category $\mathcal{A}\op$.}

Since any functor which is a right adjoint preserves limits, any right adjoint functor between abelian categories must be left exact. For example, there is an adjunction
\begin{equation*}
  - \otimes_{R} N : \mathbf{Mod}\mhyp R \longleftrightarrow \mathbf{Ab} : \Hom_{\mathbf{Ab}}(N, -)
\end{equation*}
which comes from replacing a map out of the tensor product by its corresponding bilinear map, and currying along the first entry. Thus, the map $- \otimes_{R} N$ is a left adjoint, hence preserves colimits, hence is right exact.

We can use this to check exactness (hence limit preservation) of other functors using the following beefed-up version of the Yoneda lemma.

\begin{lemma}
  \label{lemma:yoneda_reflects_exactness}
  Let $\mathcal{A}$ be an abelian category, and let
  \begin{equation*}
    \begin{tikzcd}
      A
      \arrow[r, "f"]
      & B
      \arrow[r, "g"]
      & C
    \end{tikzcd}
  \end{equation*}
  be objects and morphisms in $\mathcal{A}$. If for all $X$ the abelian groups and homomorphisms
  \begin{equation*}
    \begin{tikzcd}
      \Hom_{\mathcal{A}}(X, A)
      \arrow[r, "f_{*}"]
      & \Hom_{\mathcal{A}}(X, B)
      \arrow[r, "g_{*}"]
      & \Hom_{\mathcal{A}}(X, C)
    \end{tikzcd}
  \end{equation*}
  form an exact sequence of abelian groups, then $A \to B \to C$ is exact.
\end{lemma}
\begin{proof}
  To see this, take $X = A$, giving the following sequence.
  \begin{equation*}
    \begin{tikzcd}
      \Hom_{\mathcal{A}}(A, A)
      \arrow[r, "f_{*}"]
      & \Hom_{\mathcal{A}}(A, B)
      \arrow[r, "g_{*}"]
      & \Hom_{\mathcal{A}}(A, C)
    \end{tikzcd}
  \end{equation*}
  Exactness implies that
  \begin{equation*}
    0 = (g_{*} \circ f_{*})(\id) = (g \circ f)(\id) = g \circ f,
  \end{equation*}
  so $\im f \subset \ker g$. Now take $X = \ker g$.
  \begin{equation*}
    \begin{tikzcd}
      \Hom_{\mathcal{A}}(\ker g, A)
      \arrow[r, "f_{*}"]
      & \Hom_{\mathcal{A}}(\ker g, B)
      \arrow[r, "g_{*}"]
      & \Hom_{\mathcal{A}}(\ker g, C)
    \end{tikzcd}
  \end{equation*}
  The canonical inclusion $\iota\colon \ker g \to B$ is mapped to zero under $g_{*}$, hence is mapped to under $f_{*}$ by some $\alpha\colon \ker g \to A$. That is, we have the following commuting triangle.
  \begin{equation*}
    \begin{tikzcd}[column sep=small]
      & A
      \arrow[dr, "f"]
      \\
      \ker g
      \arrow[ur, "\alpha"]
      \arrow[rr, hookrightarrow, swap, "\iota"]
      && B
    \end{tikzcd}
  \end{equation*}
  Thus $\im \iota = \ker g \subset \im f$.
\end{proof}

\section{Quasi-isomorphism}
\label{sec:quasi_isomorphism}

One of the organizing principles of homological algebra is that the fundamental data contained in a chain complex is the level-wise homology of that chain complex, rather than the chain complex itself. We will see many examples (especially in \hyperref[part:algebraic_topology]{Part~\ref*{part:algebraic_topology}}, on algebraic topology) in which one can perform a drastic simplification of a problem by replacing a chain complex by a better-behaved one, together with a homology-preserving map between them.

For this reason, one would like to understand morphisms of chain complexes $f_{\bullet}\colon C_{\bullet} \to D_{\bullet}$ which induce isomorphisms on homology. One even has a special name for such a morphism.

\begin{definition}[quasi-isomorphism]
  \label{def:quasi_isomorphism}
  Let $f_{\bullet}\colon C_{\bullet} \to D_{\bullet}$ be a chain map. We say that $f$ is a \defn{quasi-isomorphism} if it induces isomorphisms on homology; that is, if $H_{n}(f)$ is an isomorphism for all $n$.
\end{definition}

Quasi-isomorphisms are a surprisingly fiddly concept. Since they induce isomorphisms on homology, and isomorphisms are invertible, one might navely hope that quasi-isomorphisms themselves were invertible; that is, that one could find a \emph{quasi-inverse.} Unfortunately, we are not so lucky. Consider the following morphism of chain complexes.
\begin{equation*}
  \begin{tikzcd}
    0
    \arrow[r]
    & \Z
    \arrow[r, "\times 2"]
    \arrow[d]
    & \Z
    \arrow[r]
    \arrow[d, "\id"]
    & 0
    \\
    0
    \arrow[r]
    & 0
    \arrow[r]
    & \Z/2\Z
    \arrow[r]
    & 0
  \end{tikzcd}
\end{equation*}
This map induces an isomorphism on homology, but there is no non-trivial map in the other direction.

\section{Chain Homotopies}
\label{sec:chain_homotopies}

Chain homotopies are, at this point, best thought of as a technical tool which allow us to better understand quasi-isomorphisms. The interested reader should look forward to \hyperref[part:algebraic_topology]{Part~\ref*{part:algebraic_topology}}, where we will reach an understanding of chain homotopies as an algebraic analog of a homotopy between maps of topological spaces.

\begin{definition}[chain homotopy]
  \label{def:chain_homotopy}
  Let $f_{\bullet}$, $g_{\bullet}\colon C_{\bullet} \to D_{\bullet}$ be morphisms of chain complexes. A \defn{chain homotopy} between $f_{\bullet}$ and $g_{\bullet}$ is a family of maps
  \begin{equation*}
    h_{n}\colon C_{n} \to D_{n+1}
  \end{equation*}
  such that
  \begin{equation*}
    d^{D}_{n+1} \circ h_{n} + h_{n-1} \circ d^{C}_{n} = f - g.
  \end{equation*}
\end{definition}

Chain homotopies will help us to understand the slippery notion of quasi-isomorphism because chain homotopic maps will turn out to induce the same maps on homology.

\begin{proposition}
  \label{prop:chain_homotopic_maps_induce_same_map_on_homology}
  Let $f$, $g\colon C_{\bullet} \to D_{\bullet}$ be chain homotopic maps via a homotopy $h$. Then for all $n$,
  \begin{equation*}
    H_{n}(f) = H_{n}(g).
  \end{equation*}
\end{proposition}
\begin{proof}
  Since homology is additive, it suffices to show that any map which is homotopic to zero induces the zero map on homology, i.e.\ that if we can write
  \begin{equation*}
    f = d^{D}_{n+1} \circ h_{n} + h_{n-1} \circ d^{C}_{n},
  \end{equation*}
  then $H_{n}(f) = 0$ for all $n$.
\end{proof}

This is very useful, both theoretically and practically. We will often exploit this in order to prove that a complex is exact by showing that the identity morphism is homotopic to the zero morphism.

\begin{lemma}
  \label{lemma:additive_functors_preserve_homotopy}
  Let $f_{\bullet}$, $g_{\bullet}\colon C_{\bullet} \to D_{\bullet}$ be a homotopic chain complexes via a homotopy $h$, and let $F$ be an additive functor. Then $F(h)$ is a homotopy between $F(f_{\bullet})$ and $F(g_{\bullet})$.
\end{lemma}
\begin{proof}
  We have
  \begin{equation*}
    df + fd = h,
  \end{equation*}
  so
  \begin{equation*}
    F(d)F(f) + F(f)F(d) = F(h).
  \end{equation*}
\end{proof}

\begin{lemma}
  \label{lemma:homotopy_equivalence_relation}
  Homotopy of morphisms is an equivalence relation.
\end{lemma}
\begin{proof}
  \leavevmode
  \begin{itemize}
    \item Reflexivity: the zero morphism provides a homotopy between $f \sim f$.

    \item Symmetry: If $f \overset{h}{\sim} g$, then $g \overset{-h}{\sim} f$

    \item Transitivity: If $f \overset{h}{\sim} f'$ and $f' \overset{h'}{\sim} f''$, then $f \overset{h + h'}{\sim} f''$.
  \end{itemize}
\end{proof}

\begin{lemma}
  \label{lemma:homotopy_respects_composition}
  Homotopy respects composition. That is, let $f \overset{h}{\sim} g$ be homotopic morphisms, and let $r$ be another morphism with appropriate domain and codomain.
  \begin{itemize}
    \item $f \circ r \overset{hr}{\sim} g \circ r$

    \item $r \circ f \overset{rh}{\sim} r \circ g$.
  \end{itemize}
\end{lemma}
\begin{proof}
  Obvious.
\end{proof}

\section{Projectives and injectives}
\label{ssc:projectives_and_injectives}

One of the drawbacks of diagrammatic reasoning in abelian categories (which is to say, reasoning on elements in $\Rmod$) is that not every maneuver one can perform on elements has a diagrammatic analog. One of the most egregious examples of this is the property of lifting against epimorphisms. Given an epimorphism $f\colon A \twoheadrightarrow B$ and an element of $B$, one can always find an element of $A$ which maps to it under $f$. Unfortunately, it is \emph{not} in general the case that given a map $X \to B$, one can lift it to a map $X \to A$ making the triangle formed commute.
\begin{equation*}
  \begin{tikzcd}
    & X
    \arrow[d]
    \arrow[dl, swap, dashed, "\not\exists"]
    \\
    A
    \arrow[r, two heads, "f"]
    & B
  \end{tikzcd}
\end{equation*}
However, certain objects $X$ do have this property. For example, if $X$ is a free $R$-module, then we can find a lift by lifting generators; this is always possible. It will be interesting to find objects $X$ which allow this. Such objects are called \emph{projective.}

We will eventually be interested in projective objects because of the control they give us over quasi-isomorphisms.

\subsection{Basic properties}
\label{ssc:basic_properties}

\begin{definition}[projective, injective]
  \label{def:projective_injective}
  An object $P$ in an abelian category $\mathcal{A}$ is \defn{projective} if for every epimorphism $f\colon B \to C$ and every morphism $p\colon P \to C$, there exists a morphism $\tilde{p}\colon P \to B$ such that the following diagram commutes.
  \begin{equation*}
    \begin{tikzcd}
      & P
      \arrow[d, "p"]
      \arrow[dl, dashed, swap, "\exists\tilde{p}"]
      \\
      B
      \arrow[r, twoheadrightarrow, swap, "f"]
      & C
    \end{tikzcd}
  \end{equation*}

  Dually, $Q$ is injective if for every monomorphism $g\colon A \to B$ and every morphism $q\colon A \to Q$ there exists a morphism $\tilde{q}\colon B \to Q$ such that the following diagram commutes.
  \begin{equation*}
    \begin{tikzcd}
      A
      \arrow[r, hookrightarrow, "g"]
      \arrow[d, swap, "q"]
      & B
      \arrow[dl, dashed, "\exists \tilde{q}"]
      \\
      Q
    \end{tikzcd}
  \end{equation*}
\end{definition}

Since the hom functor $\Hom(A, -)$ is left exact for every $A$, it is very easy to see simply by unwrapping the definitions that an object $P$ in an abelian category is projective if the functor $\Hom(P, -)$ is exact, and injective if $\Hom(-, Q)$ is exact.

\subsection{Enough projectives}
\label{ssc:enough_projectives}

A recurring theme of homological algebra is that projective and injective objects are extremely nice to work with, and whenever possible we would like to be able to trade in an object or chain complex for an object or chain complex of projectives which is (quasi-)isomorphic. We will go into more detail about precisely what we mean by this later. This will be possible when our abelian category has \emph{enough projectives.} Dually, we can replace objects or chain complexes by injectives when we have \emph{enough injectives.} As the abstract theory of projectives is dual to that of injectives, we will for the remainder of this chapter confine ourselves to the study of projectives.

\begin{definition}[enough projectives]
  \label{def:enough_projectives}
  Let $\mathcal{A}$ be an abelian category. We say that $\mathcal{A}$ has \defn{enough projectives} if for every object $M$ there exists a projective object $P$ and an epimorphism $P \twoheadrightarrow M$.
\end{definition}

The category in which we have mainly been interested is $\Rmod$. We will now see that $\Rmod$ has enough projectives; we need only prove the following lemma.

\begin{lemma}
  Let
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & A
      \arrow[r, hookrightarrow]
      & B
      \arrow[r, twoheadrightarrow, "f"]
      & P
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  be a short exact sequence with $P$ projective. Then the sequence splits.
\end{lemma}
\begin{proof}
  We can add another copy of $P$ artfully as follows.
  \begin{equation*}
    \begin{tikzcd}
      &&& P
      \arrow[d, "\id"]
      \\
      0
      \arrow[r]
      & A
      \arrow[r, hookrightarrow]
      & B
      \arrow[r, twoheadrightarrow, "f"]
      & P
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  By definition, we get a morphism $P \to B$ making the triangle commute.
  \begin{equation*}
    \begin{tikzcd}
      &&& P
      \arrow[d, "\id"]
      \arrow[dl, swap, "\exists g"]
      \\
      0
      \arrow[r]
      & A
      \arrow[r, hookrightarrow]
      & B
      \arrow[r, twoheadrightarrow, swap, "f"]
      & P
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  But this says precisely that $f \circ g = \id_{P}$, i.e.\ the sequence splits from the right. The result follows from the splitting lemma (\hyperref[lemma:splitting_lemma]{Lemma~\ref*{lemma:splitting_lemma}}).
\end{proof}

\begin{proposition}
  \label{prop:projectives_are_direct_summands_of_free}
  The category $\Rmod$ has enough projectives.

  We see this by proving the following characterization of projectives in $\Rmod$: $P$ is projective if and only if it is a direct summand of a free module, i.e.\ if there exists an $R$-module $M$ and a free $R$-module $F$ such that
  \begin{equation*}
    F \simeq P \oplus M.
  \end{equation*}
  This will be sufficient because any module can be written as a quotient of a free module.

  First, suppose that $P$ is projective. We can always express $P$ in terms of a set of generators and relations. Denote by $F$ the free $R$-module over the generators, and consider the following short exact sequence.
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & \ker \pi
      \arrow[r, hookrightarrow]
      & F
      \arrow[r, twoheadrightarrow, "\pi"]
      & P
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  An easy consequence of the splitting lemma is that any short exact sequence with a projective in the final spot splits, so
  \begin{equation*}
    F \simeq P \oplus \ker \pi
  \end{equation*}
  as required.

  Conversely, suppose that $P \oplus M \simeq F$, for $F$ free, and $P$ and $M$ arbitrary. Certainly, the following lifting problem has a solution (by lifting generators).
  \begin{equation*}
    \begin{tikzcd}
      & P \oplus M
      \arrow[d, "{(f, g)}"]
      \arrow[dl, dashed, swap, "\exists {(j, k)}"]
      \\
      N
      \arrow[r, twoheadrightarrow]
      & M
    \end{tikzcd}
  \end{equation*}

  In particular, this gives us the following solution to our lifting problem,
  \begin{equation*}
    \begin{tikzcd}
      & P
      \arrow[d, "f"]
      \arrow[dl, dashed, swap, "\exists j"]
      \\
      N
      \arrow[r, twoheadrightarrow]
      & M
    \end{tikzcd}
  \end{equation*}
  exhibiting $P$ as projective.
\end{proposition}

\subsection{Here be dragons}
\label{ssc:here_be_dragons}

There are a few subtleties to the theory of projectives and injectives of which one should be aware.
\begin{itemize}
  \item We have said that the abstract theory of injectives is dual to that of projectives. This is true, but does not imply that projectives and injectives are somehow on equal footing. For example, in $\Rmod$ we have given a complete classification of projective modules: they are direct summands of free modules. There is no such classification of injective modules. Despite this, $\Rmod$ does turn out to have enough injectives.

  \item We have so far mostly avoided the use of element-theoretic arguments, which are possible thanks to the Freyd-Mitchell embedding theorem. This is partially due to an aesthetic distaste, and partially because they can be tricky.
\end{itemize}

\subsection{Projective resolutions}
\label{ssc:projective_resolutions}

We are now ready to enact a part of our goal of replacing an object or chain complex with a (quasi-)isomorphic chain complex of projectives: if we are working in an abelian category with enough projectives, we can replace an object $A$ with a quasi-isomorphic chain complex of projectives.

More concretely, let $\mathcal{A}$ be an abelian category, and denote by $\iota$ the functor which takes an object of $\mathcal{A}$ and returns a chain complex with that object concentrated in degree zero. Clearly, the homology of $\iota(A)$ is
\begin{equation*}
  H_{n}(\iota(A)) =
  \begin{cases}
    A, &n = 0 \\
    0, &n \neq 0
  \end{cases}.
\end{equation*}

Our goal, namely replacing $A$ by a chain complex which contains the same homological data, can certainly be achieved by finding a chain complex with the same homology, and a quasi-isomorphism from it to $\iota(A)$. Such an object is known as a \emph{resolution.}

\begin{definition}[resolution]
  \label{def:resolution}
  Let $A$ be an object in an abelian category. A \defn{resolution} of $A$ consists of a chain complex $C_{\bullet}$ together with a quasi-isomorphism $C_{\bullet} \simto \iota(A)$.
\end{definition}

What we want is a \emph{projective resolution,} i.e.\ a resolution made out of projective objects.

\begin{definition}[projective, injective resolution]
  \label{def:projective_injective_resolution}
  Let $\mathcal{A}$ be an abelian category, and let $A \in \mathcal{A}$. A \defn{projective resolution} of $A$ is a quasi-isomorphism $P_{\bullet} \simto \iota(A)$, where $P_{\bullet}$ is a complex of projectives. Similarly, an \defn{injective resolution} is a quasi-isomorphism $\iota(A) \simto Q_{\bullet}$ where $Q_{\bullet}$ is a complex of injectives.
\end{definition}


We said that our success in our goal would be predicated on the existence of enough projectives. Indeed, this is the case. In order to see this, we change our view on projective resolutions. Rather than a quasi-isomorphism between chain complexes whose homology is concentrated in degree zero, we should look at a projective resolution as a single, exact chain complex.

\begin{lemma}
  \label{lemma:equivalent_characterization_of_projective_resolution}
  Let $f_{\bullet}\colon P_{\bullet} \to \iota(A)$ be a chain map. Then $f$ is a projective resolution if and only if the sequence
  \begin{equation*}
    \begin{tikzcd}
      \
      \arrow[r, dotted, no head]
      & P_{2}
      \arrow[r]
      & P_{1}
      \arrow[r]
      & P_{0}
      \arrow[r, "f_{0}"]
      & A
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  is exact.
\end{lemma}

\begin{proposition}
  Let $\mathcal{A}$ be an abelian category with enough projectives. Then every object $A \in \mathcal{A}$ has a projective resolution.
\end{proposition}
\begin{proof}
  Pick a projective which surjects onto $A$, and
\end{proof}

\subsection{Lifting data to projective resolutions}
\label{ssc:lifting_data_to_projective_resolutions}

We have seen that for every object in in abelian category $\mathcal{A}$ with enough projectives, we can find a \emph{projective resolution,} i.e.\ a complex $P_{\bullet}$ of projectives and a quasi-isomorphism $P_{\bullet} \simto \iota(A)$. We would like to be able to extend this to a functor. This idea turns out not to work precisely as we would like, but it is nonetheless helpful to pursue it for a while.

The first thing we need is a way of lifting morphisms in $\mathcal{A}$ to morphisms between projective resolutions.

\begin{lemma}
  \label{lemma:lift_of_zero_morphism_homotopic_to_zero}
  Let $P_{\bullet}$ be a chain complex of projectives with $P_{n} = 0$ for $n \leq 0$, and let $D_{\bullet}$ be a chain complex with $D_{n} = 0$ for $n \leq 0$ such that $H_{n}(D) = 0$ for $n > 0$. Let $f\colon P_{\bullet} \to D_{\bullet}$ such that $f_{0} = 0$.
  \begin{enumerate}
    \item For any $f_{0}\colon P_{0} \to D_{0}$, there exists a lift to a chain map $f\colon P \to D$.

    \item Any such lifts $f$, $f'\colon P \to D$ are chain homotopic.
  \end{enumerate}
\end{lemma}
\begin{proof}
  \begin{enumerate}
    \item We construct such a lift inductively.

    \item It suffices to show that any lift of the zero morphism is chain homotopic to zero.
  \end{enumerate}
\end{proof}

\begin{proposition}
  \label{prop:can_lift_morphisms_to_projective_resolutions}
  Let $\mathcal{A}$ be an abelian category, let $M$ and $M'$ be objects of $\mathcal{A}$, and
  \begin{equation*}
    P_{\bullet} \to M \qquad\text{and}\qquad P'_{\bullet} \to M'
  \end{equation*}
  be projective resolutions. Then for every morphism $f\colon M \to M'$ there exists a lift $\tilde{f}\colon P_{\bullet} \to P'_{\bullet}$ making the diagram
  \begin{equation*}
    \begin{tikzcd}
      P_{\bullet}
      \arrow[r, "\tilde{f}_{\bullet}"]
      \arrow[d]
      & P'_{\bullet}
      \arrow[d]
      \\
      \iota M
      \arrow[r, swap, "\iota f"]
      & \iota M'
    \end{tikzcd}
  \end{equation*}
  commute, which is unique up to homotopy.
\end{proposition}
\begin{proof}
  We construct a lift inductively.
\end{proof}

\begin{theorem}[horseshoe lemma]
  \label{thm:horseshoe_lemma}
  Let $\mathcal{A}$ be an abelian category with enough projectives, and let $P'_{\bullet} \to M'$ and $P''_{\bullet} \to M''$ be projective resolutions. Then given an exact sequence
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & M'
      \arrow[r, hook, "f"]
      & M
      \arrow[r, two heads, "g"]
      & M''
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  there is a projective resolution $P_{\bullet} \to M$ and maps $\tilde{f}$ and $\tilde{g}$ such that the following diagram has exact rows and commutes.
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & P'_{\bullet}
      \arrow[r, "\tilde{f}"]
      \arrow[d]
      & P_{\bullet}
      \arrow[r, "\tilde{g}"]
      \arrow[d]
      & P''_{\bullet}
      \arrow[r]
      \arrow[d]
      & 0
      \\
      0
      \arrow[r]
      & M'
      \arrow[r, swap, hook, "f"]
      & M
      \arrow[r, swap, two heads, "\tilde{g}"]
      & M''
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
\end{theorem}
\begin{proof}
  We construct $P_{\bullet}$ inductively. We have specified data of the following form.
  \begin{equation*}
    \begin{tikzcd}
      \
      & \
      \arrow[d, dotted, no head]
      & \
      & \
      \arrow[d, dotted, no head]
      & \
      \\
      0
      \arrow[r]
      & P'_{1}
      \arrow[d]
      && P''_{1}
      \arrow[r]
      \arrow[d]
      & 0
      \\
      0
      \arrow[r]
      & P'_{0}
      \arrow[d]
      && P''_{0}
      \arrow[r]
      \arrow[d]
      & 0
      \\
      0
      \arrow[r]
      & M'
      \arrow[r, hook, "f"]
      & M
      \arrow[r, two heads, "g"]
      & M''
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  We define $P_{0} = P'_{0} \oplus P''_{0}$. We get the maps to and from $P_{0}$ from the canonical injection and projection respectively.
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & P'_{0}
      \arrow[r, "\iota"]
      \arrow[dr, dashed, swap, "f \circ p'_{0}"]
      \arrow[d, swap, "p'"]
      & P'_{0} \oplus P''_{0}
      \arrow[r, "\pi"]
      \arrow[d, dotted, "p"]
      & P''_{0}
      \arrow[r]
      \arrow[d, "p''"]
      \arrow[dl, dashed, "\exists q"]
      & 0
      \\
      0
      \arrow[r]
      & M'
      \arrow[r, swap, "f"]
      & M
      \arrow[r, swap, "g"]
      & M''
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  We get the (dashed) map $P'_{0} \to M$ by composition, and the (dashed) map $P''_{0} \to M$ by projectivity of $P''_{0}$ (since $p''$ is an epimorphism). From these the universal property for coproducts gives us the (dotted) map $p\colon P'_{0} \oplus P''_{0} \to M$.

  At this point, the innocent reader may believe that we are in the clear, and indeed many books leave it at this. Not so! We don't know that the diagram formed in this way commutes. In fact it does not; there is nothing in the world that tells us that $q \circ \pi = p$.

  However, this is but a small transgression, since the \emph{squares} which are formed still commute. To see this, note that we can write
  \begin{equation*}
    p = f \circ p'_{0} \circ \pi_{P_{0}'} + q \circ \pi;
  \end{equation*}
  composing this with

  The snake lemma guarantees that the sequence
  \begin{equation*}
    \begin{tikzcd}
      \coker p' \simeq 0
      \arrow[r]
      & \coker p
      \arrow[r]
      & 0 \simeq \coker p''
    \end{tikzcd}
  \end{equation*}
  is exact, hence that $p$ is an epimorphism.

  One would hope that we could now repeat this process to build further levels of $P_{\bullet}$. Unfortunately, this doesn't work because we have no guarantee that $d^{P''}_{1}$ is an epimorphism, so we can't use the projectiveness of $P''_{1}$ to produce a lift. We have to be clever.

  The trick is to add an auxiliary row of kernels; that is, to expand the relevant portion of our diagram as follows.
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & P'_{1}
      \arrow[d, swap, "p_{1}'"]
      && P''_{1}
      \arrow[r]
      \arrow[d, "p_{1}''"]
      & 0
      \\
      0
      \arrow[r]
      & \ker p'
      \arrow[r, dashed]
      \arrow[d]
      & \ker p
      \arrow[r, dashed]
      \arrow[d]
      & \ker p''
      \arrow[r]
      \arrow[d]
      & 0
      \\
      0
      \arrow[r]
      & P'_{0}
      \arrow[r]
      \arrow[d]
      & P_{0}
      \arrow[r]
      \arrow[d]
      & P''_{0}
      \arrow[r]
      \arrow[d]
      & 0
      \\
      0
      \arrow[r]
      & M'
      \arrow[r, hook]
      & M
      \arrow[r, two heads]
      & M''
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  The maps $p'_{1}$ and $p''_{1}$ come from the exactness of $P'_{\bullet}$ and $P''_{\bullet}$. In fact, they are epimorphisms, because they are really cokernel maps in disguise. We get the dashed map $\ker p' \to \ker p''$

  That means that we are in the same situation as before, and are justified in saying ``we proceed inductively''.
\end{proof}

\begin{theorem}[horseshoe lemma for morphisms]
  \label{thm:horseshoe_lemma_for_morphisms}
  Given a morphism of short exact sequences
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & A'
      \arrow[r, hook]
      \arrow[d, "f'"]
      & A
      \arrow[r, two heads]
      \arrow[d, "f"]
      & A''
      \arrow[r]
      \arrow[d, "f''"]
      & 0
      \\
      0
      \arrow[r]
      & B'
      \arrow[r, hook]
      & B
      \arrow[r, two heads]
      & B''
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
\end{theorem}

\begin{theorem}
  Let $\mathcal{A}$ be an abelian category with enough projectives, and let $C_{\bullet} \in \Ch_{\geq 0}(\mathcal{A})$. Then there exists a 
\end{theorem}

\section{The homotopy category}
\label{sec:the_homotopy_category}

In the previous section, we proved many theorems which were schematically of the following form:

\emph{Given some data in an abelian category, we can lift it to data between projective resolutions.}

One might hope that this data would assemble itself functorially, but this is far too much to ask; we have no reason to believe, having picked lifts $\tilde{f}$ for our morphisms $f$, that $\widetilde{f \circ g} = \tilde{f} \circ \tilde{g}$.

In this, however, we are saved by the notion of homotopy! While $\widetilde{f \circ g}$ and $\tilde{f} \circ \tilde{g}$ may not be equal, they are certainly homotopic, thanks to \hyperref[prop:can_lift_morphisms_to_projective_resolutions]{Proposition~\ref*{prop:can_lift_morphisms_to_projective_resolutions}}. Thus, we will have a shot at functoriality, if we formally invert all homotopies.

And this we can do!

\begin{definition}[homotopy category]
  \label{def:homotopy_category}
  Let $\mathcal{A}$ be an abelian category. The \defn{homotopy category} $\mathcal{K}(\mathcal{A})$, is the category whose objects are those of $\Ch(\mathcal{A})$, and whose morphisms are equivalence classes of morphisms in $\mathcal{A}$ up to homotopy.
\end{definition}

This is well-defined by \hyperref[lemma:homotopy_equivalence_relation]{Lemma~\ref*{lemma:homotopy_equivalence_relation}} and \hyperref[lemma:homotopy_respects_composition]{Lemma~\ref*{lemma:homotopy_respects_composition}}.

We will in general not be interested in the full homotopy category, but instead in the bounded-below homotopy category $\mathcal{K}^{+}(\mathcal{A})$ of \emph{bounded-below} chain complexes up to homotopy.


\begin{lemma}
  \label{lemma:homotopy_category_is_additive}
  The homotopy category $\mathcal{K}^{+}(\mathcal{A})$ is an additive category, and the quotienting functor $\Ch_{\geq 0}(\mathcal{A}) \to \mathcal{K}^{+}(\mathcal{A})$ is an additive functor.
\end{lemma}
\begin{proof}
  Trivial.
\end{proof}

%\begin{proposition}
%  \label{prop:additive_functors_from_derived_category_squash_homotopies}
%  Let $\mathcal{F}\colon \Ch(\mathcal{A}) \to \mathcal{B}$ be an additive functor which takes quasi-isomorphisms to isomorphisms. Then for homotopic morphisms $f \sim g$ in $\Ch(\mathcal{A})$, we have $F(f) = F(g)$.
%\end{proposition}

The upshot of the above discussion is that for any abelian category with enough projectives, there are projective resolution functors $\mathcal{A} \to \mathcal{K}^{+}(\mathcal{A})$ defined as follows.
\begin{enumerate}
  \item Pick a projective resolution of every object in $\mathcal{A}$.

  \item Pick a lift of every morphism of $\mathcal{A}$, and take equivalence classes.
\end{enumerate}

This functor has

\section{Mapping cones}
\label{sec:mapping_cones}

Mapping cones are a technical tool, borrowed from algebraic topology. We will use them to great profit in the next section. For now, 

%an amazing result: as long as we restrict our attention from bounded below chain complexes to bounded-below chain complexes of projectives, then the pathology associated to quasi-isomorphisms, i.e.\ that we 

\begin{definition}[shift functor]
  \label{def:shift_functor}
  For any chain complex $C_{\bullet}$ and any $k \in \Z$, define the \defn{$k$-shifted chain complex} $C_{\bullet}[k]$ by
  \begin{equation*}
    C[k]_{i} = C_{k+i};\qquad d^{C[k]}_{i} = (-1)^{k}d^{C}_{i+k}.
  \end{equation*}
\end{definition}

\begin{definition}[mapping cone]
  \label{def:mapping_cone}
  Let $f\colon C_{\bullet} \to D_{\bullet}$ be a chain map. Define a new complex $\cone(f)$ as follows.
  \begin{itemize}
    \item For each $n$, define
      \begin{equation*}
        \cone(f)_{n} = C_{n-1} \oplus D_{n}.
      \end{equation*}

    \item Define $d^{\cone(f)}_{n}$ by
      \begin{equation*}
        d^{\cone(f)}_{n} =
        \begin{pmatrix}
          -d^{C}_{n-1} & 0 \\
          -f_{n-1} & d^{D}_{n}
        \end{pmatrix},
      \end{equation*}
      which is shorthand for
      \begin{equation*}
        d^{\cone(f)}_{n}(x_{n-1}, y_{n}) = (-d^{C}_{n-1}x_{n-1}, d^{D}_{n}y_{n} - f_{n-1}x_{n-1}).
      \end{equation*}
  \end{itemize}
\end{definition}

\begin{lemma}
  \label{lemma:cone_fits_into_ses}
  The complex $\cone(f)$ naturally fits into a short exact sequence
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & D_{\bullet}
      \arrow[r, "\iota"]
      & \cone(f)_{\bullet}
      \arrow[r, "\pi"]
      & C[-1]_{\bullet}
      \arrow[r]
      & 0
    \end{tikzcd}.
  \end{equation*}
\end{lemma}
\begin{proof}
  We need to specify $\iota$ and $\pi$. The morphism $\iota$ is the usual injection; the morphism $\pi$ is given by minus the usual projection.
\end{proof}

\begin{corollary}
  \label{cor:cone_controls_quasi_isomorphism}
  Let $f_{\bullet}\colon C_{\bullet} \to D_{\bullet}$ be a morphism of chain complexes. Then $f$ is a quasi-isomorphism if and only if $\cone(f)$ is an exact complex.
\end{corollary}
\begin{proof}
  By \hyperref[cor:long_exact_sequence_on_homology]{Corollary~\ref*{cor:long_exact_sequence_on_homology}}, we get a long exact sequence
  \begin{equation*}
    \cdots \to  H_{n}(C) \overset{\delta}{\to} H_{n}(D) \to H_{n}(\cone(f)) \to H_{n-1}(C) \to \cdots.
  \end{equation*}

  We still need to check that $\delta = H_{n}(f)$. This is not hard to see; picking $x \in \ker d^{X}$, the zig-zag defining $\delta$ goes as follows.
  \begin{equation*}
    \begin{tikzcd}
      && x
      \arrow[d, mapsto]
      \\
      & (x, 0)
      \arrow[r, mapsto]
      \arrow[d, mapsto]
      & -x
      \\
      f(x)
      \arrow[r, mapsto]
      \arrow[d, mapsto]
      & (0, f(x))
      \\
      {[f(x)]}
    \end{tikzcd}
  \end{equation*}
  If $\cone(f)$ is exact, then we get a very short exact sequence
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & H_{n}(X)
      \arrow[r, "H_{n}(f)"]
      & H_{n}(Y)
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  implying that $H_{n}(f)$ must be an isomorphism. Conversely, if $H_{n}(f)$ is an isomorphism for all $n$, then the maps to and from $H_{n}(\cone(f))$ must be the zero maps, implying $H_{n}(\cone(f)) = 0$ by exactness.
\end{proof}

\begin{proposition}
  Let $\mathcal{A}$ be an abelian category, and let $C_{\bullet}$ be a chain complex in $\mathcal{A}$. Let $P_{\bullet}$ be a bounded below chain complex of projectives. Then any quasi-isomorphism $g\colon P_{\bullet} \to C_{\bullet}$ has a quasi-inverse.
\end{proposition}
\begin{proof}
  First we show that any morphism from a projective, bounded below complex into an exact complex is homotopic to zero. We do so by constructing a homotopy.
  \begin{equation*}
    \begin{tikzcd}
      \
      \arrow[r, dotted, no head]
      & P_{1}
      \arrow[r]
      \arrow[d]
      & P_{0}
      \arrow[r]
      \arrow[d]
      \arrow[dl, dashed, swap, "h_{1}"]
      & 0
      \arrow[d]
      \arrow[dl, dashed, swap, "h_{0}"]
      \arrow[r, dotted, no head]
      &\
      \\
      \
      \arrow[r, dotted, no head]
      & C_{1}
      \arrow[r]
      & C_{0}
      \arrow[r]
      & C_{-1}
      \arrow[r, dotted, no head]
      &\
    \end{tikzcd}
  \end{equation*}
  Consider the following solid commuting diagram, where $K$ is the kernel of $d^{C}_{1}$ and $r = f_{1} - h_{0} \circ d^{P}_{1}$ is \emph{not} the map $f_{1}$.
  \begin{equation*}
    \begin{tikzcd}
      && P_{1}
      \arrow[dd, "r"]
      \arrow[ddrr, "0"]
      \arrow[dl, dashed, "\exists!"]
      \arrow[ddll, dashed, bend right, swap, "\exists h_{1}"]
      \\
      & K
      \arrow[dr, hookrightarrow]
      \\
      C_{2}
      \arrow[ur, twoheadrightarrow]
      \arrow[rr, swap, "d^{C}_{2}"]
      && C_{1}
      \arrow[rr, swap, "d^{C}_{1}"]
      && C_{0}
    \end{tikzcd}
  \end{equation*}
  Because
  \begin{align*}
    d^{C}_{1} \circ r &= d^{C}_{1} \circ f_{1} - d^{C}_{1} \circ h_{0} \circ d^{P}_{1} \\
    &= d^{C}_{1} \circ f_{1} - d^{C}_{1} \circ f_{1} \\
    &= 0,
  \end{align*}
  the morphism $r$ factors through $K$. This gives us a morphism from a projective onto the target of an epimorphism, which we can lift to the source. This is what we call $h_{1}$.

  It remains to check that $h_{1}$ is a homotopy from $f$ to $0$. Plugging in, we find
  \begin{align*}
    d^{C}_{2} \circ h_{1} + h_{0} \circ d^{P}_{1} &= r + h_{0} \circ d^{P}_{1} \\
    &= f_{1}
  \end{align*}
  as required.

  Iterating this process, we get a homotopy between $0$ and $f$.

  Now let $f\colon C_{\bullet} \to P_{\bullet}$ be a quasi-isomorphism, where $P_{\bullet}$ is a bounded-below projective complex. Since $f$ is a quasi-isomorphism, $\cone(f)$ is exact, which means that $\iota\colon P \to \cone(f)$ is homotopic to the zero morphism.
  \begin{equation*}
    \begin{tikzcd}
      P_{i+1}
      \arrow[r, "d^{P}_{i+1}"]
      \arrow[d, bend left, "\iota_{i+1}"]
      \arrow[d, bend right, swap, "0"]
      & P_{i}
      \arrow[r, "d^{P}_{i}"]
      \arrow[d, bend left, "\iota_{i}"]
      \arrow[d, bend right, swap, "0"]
      \arrow[dl, dashed, swap, "\tilde{h}_{i}"]
      & P_{i-1}
      \arrow[d, bend left, "\iota_{i-1}"]
      \arrow[d, bend right, swap, "0"]
      \arrow[dl, dashed, swap, "\tilde{h}_{i-1}"]
      \\
      C_{i} \oplus P_{i+1}
      \arrow[r, swap, "d^{\cone(f)}_{i+1}"]
      & C_{i-1} \oplus P_{i}
      \arrow[r, swap, "d^{\cone(f)}_{i}"]
      & C_{i-2} \oplus P_{i-1}
    \end{tikzcd}
  \end{equation*}
  That is, there exist $\tilde{h}_{i}\colon P_{i} \to \cone(f)_{i+1}$ such that
  \begin{equation}
    \label{eq:cone_identity}
    d^{\cone f}_{i+1} \circ \tilde{h}_{i} + \tilde{h}_{i-1} \circ d^{P}_{i} = \iota.
  \end{equation}

  Writing $\tilde{h}_{i}$ in components as $\tilde{h}_{i} = (\beta_{i}, \gamma_{i})$, where
  \begin{equation*}
    \beta_{i}\colon P_{i} \to C_{i}\qquad\text{and}\qquad \gamma_{i}\colon P_{i-1} \to P_{i},
  \end{equation*}
  we find what looks tantalizingly like a chain map $\beta_{\bullet}\colon P_{\bullet} \to C_{\bullet}$. Indeed, writing \hyperref[eq:cone_identity]{Equation~\ref*{eq:cone_identity}} in components, we find the following.
  \begin{align*}
    \begin{pmatrix}
      -d^{C}_{i} & 0 \\
      -f_{i} & d^{P}_{i+1}
    \end{pmatrix}
    \begin{pmatrix}
      \beta_{i} \\
      \gamma_{i}
    \end{pmatrix}
    +
    \begin{pmatrix}
      \beta_{i-1} \\
      \gamma_{i-1}
    \end{pmatrix}
    \begin{pmatrix}
      d^{P}_{i}
    \end{pmatrix}
    &=
    \begin{pmatrix}
      0 \\
      \id_{P_{i}}
    \end{pmatrix}
    \\
    \begin{pmatrix}
      -d^{C}_{i} \circ \beta_{i} + \beta_{i-1} \circ d^{P}_{i} \\
      -f_{i} \circ \beta_{i} + d^{P}_{i+1} \circ \gamma_{i} + \gamma_{i-1} \circ d^{P}_{i}
    \end{pmatrix}
    &=
    \begin{pmatrix}
      0 \\
      \id_{P_{i}}
    \end{pmatrix}
  \end{align*}
  The first line tells us that $\beta$ is a chain map. The second line tells us that
  \begin{equation*}
    d^{P}_{i+1} \circ \gamma_{i} + \gamma_{i-1} \circ d^{P}_{i} = \id_{P_{i}} - f_{i} \circ \beta_{i},
  \end{equation*}
  i.e.\ that $\gamma$ is a homotopy $\id_{P_{i}} \sim f_{i} \circ \beta_{i}$. But homology collapses homotopic maps, so
  \begin{equation*}
    H_{n}(\id_{P_{i}}) = H_{n}(f_{i}) \circ H_{n}(\beta_{i}),
  \end{equation*}
  which imples that
  \begin{equation*}
    H_{n}(\beta_{i}) = H_{n}(f_{i})^{-1}.
  \end{equation*}
\end{proof}


\section{Derived functors}
\label{sec:derived_functors}

\subsection{Derived categories}
\label{ssc:derived_categories}

%We can embed any abelian category $\mathcal{A}$ into the corresponding category $\Ch_{\geq 0}(\mathcal{A})$ of chain complexes via inclusion into degree zero. This is obviously a lossless procedure, in the sense that we recover $\mathcal{A}$ by restricting to degree $0$.
%\begin{equation*}
%  \begin{tikzcd}
%    \mathcal{A}
%    \arrow[r, bend left, "\iota"]
%    & \Ch(\mathcal{A})
%    \arrow[l, bend left, "(-)_{0}"]
%  \end{tikzcd}
%\end{equation*}
%
%Equivalently, we recover our category $\mathcal{A}$ by taking zeroth homology.
%\begin{equation*}
%  \begin{tikzcd}
%    \mathcal{A}
%    \arrow[r, bend left, "\iota"]
%    & \Ch(\mathcal{A})
%    \arrow[l, bend left, "H_{0}"]
%  \end{tikzcd}
%\end{equation*}
%
%However, we notice that there are much better-behaved embeddings of $\mathcal{A}$ into $\Ch_{}(\mathcal{A})$ such that we recover $\mathcal{A}$ when taking zeroth homology. For example, taking projective resolutions of objects and lifting morphisms using \hyperref[prop:can_lift_morphisms_to_projective_resolutions]{Proposition~\ref*{prop:can_lift_morphisms_to_projective_resolutions}} will do the trick. Unfortunately, this is not in general uniquely defined: one can take many different projective resolutions, and lift morphisms in many different ways. There is no reason to expect these data to assemble themselves functorially.

Hopefully, the reader will now agree that chain complexes are interesting enough to study, and that given a chain complex, the level-wise homology (and therefore the slippery notion of quasi-isomorphism) is an interesting invariant. Of course, one considers the category of chain complexes, but this category has the annoying feature that quasi-isomorphisms do not necessarily have quasi-inverses. That is, it is difficult to view quasi-isomorphism as a notion of equivalence because is it is not invertible.

The way out of this is to replace the category $\Ch_{\geq 0}(\mathcal{A})$ by a category in which all quasi-isomorphisms have quasi-inverses. There is a fiddly and conceptually unclear way to do that, namely by forming the categorical localization.
\begin{equation*}
  \Ch_{\geq 0}(\mathcal{A}) \to \Ch_{\geq 0}(\mathcal{A})[\{\text{quasi-isomorphisms}\}^{-1}].
\end{equation*}

Unfortunately, localization is not at all a trivial process, and one can get hurt if one is not careful. For that reason, actually constructing the above localization and then working with it is not a profitable approach to take.

However, note that we can get what we want by making a more draconian identification: collapsing all homotopy equivalences. Homotopy equivalence is friendlier than quasi-isomorphism in the sense that one can take the quotient by it; that is, there is a well-defined additive functor
\begin{equation*}
  \Ch_{\geq 0}(\mathcal{A}) \to \mathcal{K}(\mathcal{A})
\end{equation*}
which is the identity on objects and sends morphisms to their equivalence classes modulo homotopy; this sends precisely homotopy equivalences to isomorphisms. By

\subsection{Derived functors}
\label{ssc:derived_functors}

\begin{definition}[derived functor]
  \label{def:derived_functor}
  Let $F\colon \mathcal{A} \to \mathcal{B}$ be a functor between abelian categories.
  \begin{itemize}
    \item If $F$ is right exact and $\mathcal{A}$ has enough projectives, we declare the \defn{left derived functor} to be the homological $\delta$-functor $\{L_{n}F\}$ defined by
      \begin{equation*}
        L_{n}F =
        \begin{tikzcd}
          \mathcal{A}
          \arrow[r, "P"]
          & \mathcal{K}(\Ch_{\geq 0}(\mathcal{A}))
          \arrow[r, "F"]
          & \mathcal{K}(\Ch_{\geq 0}(\mathcal{B}))
          \arrow[r, "H_{n}"]
          & \mathcal{B}
        \end{tikzcd}
      \end{equation*}
      where $P\colon \mathcal{A} \to \mathcal{K}(\Ch_{\geq 0}(\mathcal{A}))$ is a projective resolution functor.

    \item If $F$ is left exact and $\mathcal{A}$ has enough injectives, we define the \defn{right derived functor} to be the cohomological $\delta$-functor
      \begin{equation*}
        R^{n}F(X) = H^{n} \circ F \circ Q
      \end{equation*}
      where $Q$ is an injective resolution functor.
  \end{itemize}
\end{definition}

\begin{definition}[homological \texorpdfstring{$\delta$}{delta}-functor]
  \label{def:homological_delta_functor}
  A \defn{homological $\delta$-functor} between abelian categories $\mathcal{A}$ and $\mathcal{B}$ consists of the following data.
  \begin{enumerate}
    \item For each $n \in \Z$, an additive functor
      \begin{equation*}
        T_{n}\colon \mathcal{A} \to \mathcal{B}.
      \end{equation*}

    \item For every short exact sequence
      \begin{equation*}
        \begin{tikzcd}
          0
          \arrow[r]
          & A
          \arrow[r]
          & B
          \arrow[r]
          & C
          \arrow[r]
          & 0
        \end{tikzcd}
      \end{equation*}
      in $\mathcal{A}$ and for each $n \in \Z$, a morphism
      \begin{equation*}
        \delta_{n}\colon T_{n}(C) \to T_{n-1}(A).
      \end{equation*}
  \end{enumerate}
  This data is subject to the following conditions.
  \begin{enumerate}
    \item For $n < 0$, we have $T_{n} = 0$.

    \item For every short exact sequence as above, there is a long exact sequence
      \begin{equation*}
        \begin{tikzcd}
          & \cdots
          \arrow[r]
          & T_{n+1}(C)
          \\
          T_{n}(A)
          \arrow[from=urr, out=-22, in=157, looseness=1, overlay, "\delta" description]
          \arrow[r, "T_{n}(f)"]
          & T_{n}(B)
          \arrow[r, "T_{n}(g)"]
          & T_{n}(C)
          \\
          T_{n-1}(A)
          \arrow[from=urr, out=-22, in=157, looseness=1, overlay, "\delta" description]
          \arrow[r, "T_{n-1}(f)"]
          & T_{n-1}(B)
          \arrow[r, "T_{n-1}(g)"]
          & T_{n-1}(C)
          \\
          T_{n-2}(A)
          \arrow[from=urr, out=-22, in=157, looseness=1, overlay, "\delta" description]
          \arrow[r]
          & \cdots
        \end{tikzcd}
      \end{equation*}

    \item For every morphism of short exact sequences
      \begin{equation*}
        \begin{tikzcd}
          0
          \arrow[r]
          & A
          \arrow[r]
          \arrow[d, swap, "f"]
          & B
          \arrow[r]
          \arrow[d, "g"]
          & C
          \arrow[r]
          \arrow[d, "h"]
          & 0
          \\
          0
          \arrow[r]
          & A'
          \arrow[r]
          & B'
          \arrow[r]
          & C'
          \arrow[r]
          & 0
        \end{tikzcd}
      \end{equation*}
      and every $n$, the diagram
      \begin{equation*}
        \begin{tikzcd}
          T_{n}(C)
          \arrow[r, "\delta_{n}"]
          \arrow[d, swap, "T_{n}(h)"]
          & T_{n-1}(A)
          \arrow[d, "T_{n}(f)"]
          \\
          T_{n}(C')
          \arrow[r, swap, "\delta_{n}"]
          & T_{n-1}(A')
        \end{tikzcd}
      \end{equation*}
      commutes; that is, a morphism of short exact sequences leads to a morphism of long exact sequences.
  \end{enumerate}

  A morphism $S \to T$ of $\delta$-functors consists of, for each $n$, a natural transformation $S_{n} \to T_{n}$ compatible with the $\delta$.
\end{definition}

This seems like an inelegant definition, and indeed it is.

\begin{example}
  The prototypical example of a homological $\delta$-functor is homology: the collection $H_{n}\colon \Ch(\mathcal{A}) \to \mathcal{A}$, together with the collection of connecting homomorphisms, is a homological delta-functor. In fact, the most interesting homological delta functors called \emph{derived functors,} come from homology.
\end{example}

\begin{definition}[cohomological \texorpdfstring{$\delta$}{delta}-functors]
  \label{def:cohomological_delta_functors}
  Dual to \hyperref[def:homological_delta_functor]{Definition~\ref*{def:homological_delta_functor}}.
\end{definition}



We still need to show that derived functors are in fact homological delta-functors.

\begin{theorem}
  For any right exact functor $F\colon \mathcal{A} \to \mathcal{B}$ between abelian categories $\mathcal{A}$ and $\mathcal{B}$, where $\mathcal{A}$ has enough projectives, the left derived functor $\{L_{n}F\}$ is a homological $\delta$-functor.
\end{theorem}
\begin{proof}
  We check each condition separately.
  \begin{enumerate}
    \item $L_{n}F$ is computed by taking the $n$th homology of a chain complex concentrated in positive degree.

    \item Start with a short exact sequence
      \begin{equation*}
        \begin{tikzcd}
          0
          \arrow[r]
          & A
          \arrow[r, hook]
          & B
          \arrow[r, two heads]
          & C
          \arrow[r]
          & 0
        \end{tikzcd}
      \end{equation*}
      in $\mathcal{A}$.

      We compute the image of this sequence under the derived functors $L_{n}F$ by using our chosen projective resolution functor to find projective resolutions and lift maps, and take homology. In general, we cannot be guaranteed that we can lift our exact sequence up to an exact sequence of projective resolutions
      \begin{equation*}
        \begin{tikzcd}
          0
          \arrow[r]
          & P^{A}_{\bullet}
          \arrow[r, hook]
          & P^{B}_{\bullet}
          \arrow[r, two heads]
          & P^{C}_{\bullet}
          \arrow[r]
          & 0
        \end{tikzcd}.
      \end{equation*}
      However, we have shown that, up to isomorphism, it doesn't matter which projective resolutions we choose, so we can choose those given by the horseshoe lemma (\hyperref[thm:horseshoe_lemma]{Theorem~\ref*{thm:horseshoe_lemma}}), giving us such an exact sequence. Applying $F$ then gives us another exact sequence, and taking homology gives a long exact sequence.

    \item We do the same thing, but now apply the horseshoe lemma on morphisms (\hyperref[thm:horseshoe_lemma_for_morphisms]{Theorem~\ref*{thm:horseshoe_lemma_for_morphisms}}).
  \end{enumerate}
\end{proof}

\begin{proposition}
  Let $F\colon \mathcal{A} \to \mathcal{B}$ be a right exact functor between abelian categories. We have that
  \begin{equation*}
    L_{0}F \simeq F.
  \end{equation*}
\end{proposition}
\begin{proof}
  Let $P_{\bullet} \to X$ be a projective resolution. By \hyperref[lemma:equivalent_characterization_of_projective_resolution]{Lemma~\ref*{lemma:equivalent_characterization_of_projective_resolution}}, the following sequence is exact.
  \begin{equation*}
    \begin{tikzcd}
      P_{1}
      \arrow[r, "f"]
      & P_{0}
      \arrow[r, twoheadrightarrow]
      & X
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  Since $F$ is right exact, the following sequence is exact.
  \begin{equation*}
    \begin{tikzcd}
      F(P_{1})
      \arrow[r, "F(f)"]
      & F(P_{0})
      \arrow[r, twoheadrightarrow]
      & F(X)
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  This tells us that $F(X) \simeq \coker(F(f))$. But
  \begin{equation*}
    \coker(H(f)) \simeq H_{0}(P_{\bullet}) = L_{0}F(X).
  \end{equation*}
\end{proof}

Given a right exact functor $F$, the above theorem shows that, at the lowest level, the left derived functor gives $F$ itself. It turns out that $\{L_{n}F\}$ is the \emph{universal} homological $\delta$-functor with this property:

\begin{proposition}
  Let $F\colon \mathcal{A} \to \mathcal{B}$ be a right exact functor between abelian categories where $\mathcal{A}$ has enough projectives, let $\{T_{n}\}$ be a homological $\delta$-functor, and let $\phi_{0}\colon T_{0} \Rightarrow F = L_{0}F$ be a natural transformation. Then there exists a unique lift of $\phi_{0}$ to a morphism $\{\phi_{i}\colon T_{i} \to L_{i}F\}$.
\end{proposition}
\begin{proof}
  First we construct $\phi_{1}\colon T_{1} \Rightarrow L_{1}F$. For each object $A \in \mathcal{A}$, pick a projective which surjects onto it and take a kernel, giving the following short exact sequence.
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & K
      \arrow[r, hook]
      & P
      \arrow[r, two heads]
      & A
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  Applying each of our homological $\delta$-functors and using the fact that $L_{i}FP = 0$ for $i > 0$, we get the following data.
  \begin{equation*}
    \begin{tikzcd}
      & T_{1}A
      \arrow[r, "\delta"]
      & T_{0}K
      \arrow[r]
      \arrow[d, "(\phi_{0})_{K}"]
      & T_{0}P
      \arrow[r]
      \arrow[d, "(\phi_{0})_{P}"]
      & T_{0}A
      \arrow[r]
      \arrow[d, "(\phi_{0})_{A}"]
      & 0
      \\
      0
      \arrow[r]
      & L_{1}FA
      \arrow[r, hook, "\delta"]
      & FK
      \arrow[r]
      & FP
      \arrow[r]
      & FA
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  Since $L_{1}FA \to FK$ is a kernel of $T_{0}K \to T_{0}P$, we get a unique map $T_{1}A \to L_{1}FA$, which we declare to be $(\phi_{1})_{A}$.

  It remains to show that these are really the components of a natural transformation. Let $f\colon A \to A'$ be a morphism in $\mathcal{A}$. Consider any induced morphisms of short exact sequences.
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & K
      \arrow[r, hook]
      \arrow[d]
      & P
      \arrow[r, two heads]
      \arrow[d]
      & A
      \arrow[r]
      \arrow[d, "f"]
      & 0
      \\
      0
      \arrow[r]
      & K'
      \arrow[r, hook]
      & P'
      \arrow[r, two heads]
      & A'
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  Since $\{L_{n}F\}$ and $\{T_{n}\}$ are homological $\delta$-functors, this gives us the following cube, where the components $(\phi_{1})_{A}$ and $(\phi_{1})_{A'}$ are dashed. All faces except the one on the left commute by definition.
  \begin{equation*}
    \begin{tikzcd}
      & T_{1}A'
      \arrow[rr]
      \arrow[dd, dashed, near start, "(\phi_{1})_{A'}"]
      && T_{0}K'
      \arrow[dd]
      \\
      T_{1}A
      \arrow[rr, crossing over]
      \arrow[ur, "T_{1}f"]
      \arrow[dd, dashed, swap, "(\phi_{1})_{A}"]
      && T_{0}K
      \arrow[ur]
      \\
      & L_{1}FA'
      \arrow[rr, near start, hook, "\delta"]
      && FK'
      \\
      L_{1}FA
      \arrow[ur, "L_{1}Ff"]
      \arrow[rr]
      && FK
      \arrow[ur]
      \arrow[from=uu, crossing over]
    \end{tikzcd}
  \end{equation*}
  In order to check that the $(\phi_{1})_{A}$ form the components of a natural transformation, we need to check that the left face of the above cube commutes. Because $\delta\colon L_{1}FA' \to FK'$ is a monomorphism, it suffices to check that
  \begin{equation*}
    \delta \circ (\phi_{1})_{A'} \circ T_{1}F = \delta \circ L_{1}Ff \circ (\phi_{1})_{A}.
  \end{equation*}
  But given the commutativity of the other faces of the cube, this is clear.

  We now continue inductively, constructing $\phi_{2}$, etc.

  The last step is to show that the collection $\{\phi_{n}\}$ is really a morphism of homological $\delta$-functors, i.e.\ that for any short exact sequence
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & A''
      \arrow[r, hook]
      & A
      \arrow[r, two heads]
      & A'
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  the squares
  \begin{equation*}
    \begin{tikzcd}
      T_{n}A''
      \arrow[r, "\delta"]
      \arrow[d, swap, "(\phi_{n})_{A''}"]
      & T_{n-1}A'
      \arrow[d, "(\phi_{n-1})_{A'}"]
      \\
      L_{n}FA''
      \arrow[r, swap, "\delta"]
      & L_{n-1}FA'
    \end{tikzcd}
  \end{equation*}
  commute
\end{proof}

\section{Double complexes}
\label{sec:double_complexes}

Given any abelian category $\mathcal{A}$, we have considered the category of chain complexes in $\mathcal{A}$, and shown (in \hyperref[thm:category_of_chain_complexes_is_abelian]{Theorem~\ref*{thm:category_of_chain_complexes_is_abelian}}) that this is an abelian category. It is therefore natural to consider chain complexes in the category of chain complexes.
\begin{equation*}
  \left( \begin{tikzcd}
    \cdots
    \arrow[r]
    & M_{1,\bullet}
    \arrow[r]
    & M_{0,\bullet}
    \arrow[r]
    & M_{-1,\bullet}
    \arrow[r]
    & \cdots
  \end{tikzcd} \right)
  \in \Ch(\Ch(\mathcal{A})),
\end{equation*}
Such a beast is a lattice of commuting squares.
\begin{equation*}
  \begin{tikzcd}
    & \vdots
    \arrow[d]
    & \vdots
    \arrow[d]
    \\
    \cdots
    \arrow[r]
    & M_{i-1,j}
    \arrow[r]
    \arrow[d]
    & M_{i, j}
    \arrow[r]
    \arrow[d]
    & \cdots
    \\
    \cdots
    \arrow[r]
    & M_{i-1,j-1}
    \arrow[r]
    \arrow[d]
    & M_{i, j-1}
    \arrow[r]
    \arrow[d]
    & \cdots
    \\
    & \vdots
    & \vdots
  \end{tikzcd}
\end{equation*}

However, when manipulating these complexes it turns out to convenient to do something slightly different, namely work with complexes whose squares anticommute rather than commute. This is not a fundamental difference, as one can make from any lattice of commuting squares a lattice of anticommuting squares by multiplying the differentials of every other column by $-1$. This is known as the \emph{sign trick.}

\begin{definition}[double complex]
  \label{def:double_complex}
  Let $\mathcal{A}$ be an abelian category. A \defn{double complex} in $\mathcal{A}$ consists of an array $M_{i,j}$ of objects together with, for every $i$ and $j \in \Z$, morphisms
  \begin{equation*}
    d^{h}_{i,j}\colon M_{i,j} \to M_{i-1,j},\qquad d^{v}_{i,j}\colon M_{i,j} \to M_{i, j-1}
  \end{equation*}
  subject to the following conditions.
  \begin{itemize}
    \item $(d^{h})^{2} = 0$

    \item $(d^{v})^{2} = 0$

    \item $d^{h} \circ d^{v} + d^{v} \circ d^{h} = 0$
  \end{itemize}

\end{definition}

We say that a double complex is $M_{\bullet,\bullet}$ is \emph{first-quadrant} if $M_{i,j} = 0$ for $i$, $j < 0$.

Given any complex of complexes, one can construct a double complex by multiplying the differentials in every other row or column by $-1$.

\begin{definition}[total complex]
  \label{def:total_complex}
  Let $M_{\bullet, \bullet}$ be a first-quadrant\footnote{This restriction is not strictly necessary, but then one has to deal with infinite direct sums, and hence must decide whether one wants the direct sum or the direct product. We only need first-quadrant double complexes, so all of our sums will be finite.} double complex. The \defn{total complex} $\Tot(M)_{\bullet}$ is defined level-wise by
  \begin{equation*}
    \Tot(M)_{n}  = \bigoplus_{i + j = n} M_{i,j},
  \end{equation*}
  with differential given by $d_{\Tot} = d + \delta$.
\end{definition}

\begin{lemma}
  \label{lemma:total_complex_is_complex}
  The total complex really is a complex, i.e.
  \begin{equation*}
    d_{\Tot} \circ d_{\Tot} = 0.
  \end{equation*}
\end{lemma}
\begin{proof}
  Hand-wavily, we have
  \begin{equation*}
    d_{\Tot} \circ d_{\Tot} = (d + \delta) \circ (d + \delta) = d^{2} + d \circ \delta + \delta \circ d + \delta^{2} = 0.
  \end{equation*}
\end{proof}

\begin{example}
  Let $C_{\bullet} \in \Ch(\modR)$ and $D_{\bullet} \in \Ch(\Rmod)$ be chain complexes. We can form a double complex by sticking $C_{\bullet}$ into the first slot of the tensor product, $D_{\bullet}$ into the second, and using the sign trick to make the squares anticommute. The total complex of this double complex is known as the \emph{tensor product} of $C_{\bullet}$ and $D_{\bullet}$.
\end{example}

In general, computing the homology of a double complex is very difficult; we will explore some techniques for this in \hyperref[ch:spectral_sequences]{Chapter~\ref*{ch:spectral_sequences}}. However, under some special conditions, we can say something.

\begin{theorem}
  \label{thm:conditions_total_complex_exact}
  Let $M_{i,j}$ be a first-quadrant double complex. Then if either the rows $M_{\bullet, j}$ or the columns $M_{i, \bullet}$ are exact, then the total complex $\Tot(M)_{\bullet}$ is exact.
\end{theorem}
\begin{proof}
  Let $M_{i,j}$ be a first-quadrant double complex with exact rows.
  \begin{equation*}
    \begin{tikzcd}
      M_{3,0}
      \arrow[d, swap, "d_{3,0}"]
      & \iddots
      \\
      M_{2,0}
      \arrow[d, swap, "d_{2,0}"]
      & M_{2,1}
      \arrow[l, swap, "\delta_{2,1}"]
      \arrow[d, "d_{2,1}"]
      & \iddots
      \\
      M_{1,0}
      \arrow[d, swap, "d_{1,0}"]
      & M_{1,1}
      \arrow[l, swap, "\delta_{1,1}"]
      \arrow[d, "d_{1,1}"]
      & M_{1,2}
      \arrow[l, swap, "\delta_{1,2}"]
      \arrow[d, "d_{1,2}"]
      & \iddots
      \\
      M_{0,0}
      & M_{0,1}
      \arrow[l, "\delta_{0,1}"]
      & M_{0,2}
      \arrow[l, "\delta_{0,2}"]
      & M_{0,3}
      \arrow[l, "\delta_{0,3}"]
    \end{tikzcd}
  \end{equation*}
  We want to show that the total complex
  \begin{equation*}
    \begin{tikzcd}
      M_{3,0} \oplus M_{2,1} \oplus M_{1,2} \oplus M_{0,3}
      \arrow[d]
      &=
      & \Tot(M)_{3}
      \arrow[d]
      \\
      M_{2,0} \oplus M_{1,1} \oplus M_{0,2}
      \arrow[d]
      &=
      & \Tot(M)_{2}
      \arrow[d]
      \\
      M_{1,0} \oplus M_{0,1}
      \arrow[d]
      &=
      & \Tot(M)_{1}
      \arrow[d]
      \\
      M_{0,0}
      \arrow[d]
      &=
      & \Tot(M)_{0}
      \arrow[d]
      \\
      0
      && 0
    \end{tikzcd}
  \end{equation*}
  is exact.

  The proof is inductive on the degree of the total complex. At level 0 there is nothing to show; the morphism $d^{\Tot}_{1}$ is manifestly surjective since $\delta_{0,1}$ is. Since numbers greater than $1$ are for all intents and purposes interchangable, we give the inductive step for $n = 2$.

  We have a triple $m = (m_{2,0}, m_{1,1}, m_{0,2}) \in \Tot(M)_{2}$ which maps to 0 under $d^{\Tot}_{2}$; that is,
  \begin{equation*}
    d_{2,0}m_{2,0} + \delta_{1,1}m_{1,1} = 0,\qquad d_{11} m_{1,1} + \delta_{0,2} m_{0,2} = 0.
  \end{equation*}

  Our goal is to find
  \begin{equation*}
    n = (n_{3,0}, n_{2,1}, n_{1,2}, n_{0,3}) \in \Tot(M)_{3}
  \end{equation*}
  such that $d^{\Tot}_{3}n = m$.

  It turns out that we can make our lives easier by choosing $n_{3,0} = 0$. By exactness, we can always $n_{2,1}$ such that $\delta n_{2,1} = m_{2,0}$. Thus, by anti-commutativity,
  \begin{equation*}
    d \delta n_{2,1} = -\delta d n_{2,1}.
  \end{equation*}
  But $\delta n_{2,1} = m_{2,0} = -\delta m_{1,1}$, so
  \begin{equation*}
    \delta(m_{1,1} - d n_{2,1}) = 0.
  \end{equation*}
  This means that $m_{1,1} - dn_{2,1} \in \ker \delta$, i.e.\ that there exists $n_{1,2}$ such that $\delta n_{1,2} = m_{1,1} - dn_{2,1}$. Thus
  \begin{equation*}
    d \delta n_{1,2} = d m_{1,1} = -\delta m_{0,2}.
  \end{equation*}
  But
  \begin{equation*}
    d \delta n_{1,2} = -\delta d n_{1,2},
  \end{equation*}
  so
  \begin{equation*}
    \delta(m_{0,2} - d n_{1,2}) = 0.
  \end{equation*}

  Now we repeat this process, finding $n_{1,2}$ such that
  \begin{equation*}
    \delta n_{1,2} = m_{1,1} - d n_{2,1},
  \end{equation*}
  and $n_{0,3}$ such that
  \begin{equation*}
    \delta n_{0,3} = m_{0,2} - d n_{1,2}.
  \end{equation*}
  Then
  \begin{align*}
    d^{\Tot}(n_{3,0} + n_{2,1} + n_{1,2} + n_{0,3}) &= 0 + (d + \delta) n_{2,1} + (d + \delta)n_{1,2} + (d + \delta) n_{0,3} \\
    &= 0 + 0 + m_{2,0} + d n_{2,1} + (m_{1,1} - dn_{2,1}) + d n_{1,2} + (m_{0,2} - d n_{1,2}) + 0 \\
    &= m_{2,0} + m_{1,1} + m_{0,2}
  \end{align*}
  as required.
\end{proof}

\begin{example}
  Let $f_{\bullet}\colon C_{\bullet} \to D_{\bullet}$ be a morphism of chain complexes. Form from this a double complex by multiplying the differential of $C_{\bullet}$ by $-1$ and padding by zeroes on either side.
  \begin{equation*}
    \begin{tikzcd}
      & \vdots
      \arrow[d]
      & \vdots
      \arrow[d]
      \\
      0
      & D_{3}
      \arrow[d, swap, "d^{D}_{3}"]
      \arrow[l]
      & C_{3}
      \arrow[l, swap, "f_{3}"]
      \arrow[d, "-d^{C}_{3}"]
      & 0
      \arrow[l]
      \\
      0
      & D_{2}
      \arrow[l]
      \arrow[d, swap, "d^{D}_{2}"]
      & C_{2}
      \arrow[l, swap, "f_{2}"]
      \arrow[d, "-d^{C}_{2}"]
      & 0
      \arrow[l]
      \\
      0
      & D_{1}
      \arrow[d, swap, "d^{D}_{1}"]
      \arrow[l]
      & C_{1}
      \arrow[l, swap, "f_{1}"]
      \arrow[d, "-d^{C}_{1}"]
      & 0
      \arrow[l]
      \\
      0
      & D_{0}
      \arrow[d, swap, "d^{D}_{0}"]
      \arrow[l]
      & C_{0}
      \arrow[d, "-d^{C}_{0}"]
      \arrow[l, swap, "f_{0}"]
      & 0
      \arrow[l]
      \\
      0
      & D_{-1}
      \arrow[d]
      \arrow[l]
      & C_{-1}
      \arrow[l, swap, "f_{-1}"]
      \arrow[d]
      & 0
      \arrow[l]
      \\
      & \vdots
      & \vdots
    \end{tikzcd}
  \end{equation*}
  The total complex of this is simply $\cone(f)$.

  Now suppose that $f_{\bullet}$ is an isomorphism, so the rows are exact. Then by \hyperref[thm:conditions_total_complex_exact]{Theorem~\ref*{thm:conditions_total_complex_exact}}, $\Tot(f) = \cone(f)$ is exact. We have already seen this (in one direction) in \hyperref[cor:cone_controls_quasi_isomorphism]{Corollary~\ref*{cor:cone_controls_quasi_isomorphism}}.
\end{example}

Consider any morphism $\alpha$ in $\Ch_{\geq 0}(\Ch_{\geq 0}(\mathcal{A}))$ to a complex concentrated in degree 0. We can view this in two ways.
\begin{itemize}
  \item As a chain
    \begin{equation*}
      \begin{tikzcd}
        \cdots
        \arrow[r]
        & C_{2,\bullet}
        \arrow[r]
        & C_{1,\bullet}
        \arrow[r]
        & C_{0,\bullet}
        \arrow[r, "\alpha"]
        & D_{\bullet}
      \end{tikzcd}
    \end{equation*}
    hence (by inserting appropriate minus signs) a double complex $C^{D}_{\bullet,\bullet}$;

  \item As a morphism between double complexes, hence between totalizations
    \begin{equation*}
      \Tot(\alpha)_{\bullet}\colon \Tot(C)_{\bullet} \to \Tot(D)_{\bullet}.
    \end{equation*}
\end{itemize}

\begin{lemma}
  \label{lemma:total_complex_is_cone_of_quasi_isomorphism}
  These two points of view agree in the sense that
  \begin{equation*}
    \Tot(C^{D}) = \Cone(\Tot(\alpha)).
  \end{equation*}
\end{lemma}
\begin{proof}
  Write down the definitions.
\end{proof}

\begin{theorem}
  \label{thm:resolutions_in_double_complexes_are_resolutions_of_total_complex}
  Let $A_{\bullet} \in \Ch_{\geq 0}(\mathcal{A})$, and let
  \begin{equation*}
    \begin{tikzcd}
      \cdots
      \arrow[r]
      & M_{2, \bullet}
      \arrow[r]
      \arrow[d]
      & M_{1, \bullet}
      \arrow[r]
      \arrow[d]
      & M_{0, \bullet}
      \arrow[d, "\alpha_{\bullet}"]
      \\
      \cdots
      \arrow[r]
      & 0
      \arrow[r]
      & 0
      \arrow[r]
      & A_{\bullet}
    \end{tikzcd}
  \end{equation*}
  be a resolution of $A_{\bullet}$. Then $\Tot(M)$ is quasi-isomorphic to $A$.
\end{theorem}
\begin{proof}
  The sequence
  \begin{equation*}
    \begin{tikzcd}
      \cdots
      \arrow[r]
      & M_{2,\bullet}
      \arrow[r]
      & M_{1,\bullet}
      \arrow[r]
      & M_{0,\bullet}
      \arrow[r]
      & A_{\bullet}
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  is exact. By \hyperref[thm:conditions_total_complex_exact]{Theorem~\ref*{thm:conditions_total_complex_exact}}, the total complex $\Tot(M^{A})$ is exact. But by \hyperref[lemma:total_complex_is_cone_of_quasi_isomorphism]{Lemma~\ref*{lemma:total_complex_is_cone_of_quasi_isomorphism}} the total complex is equivalently the cone of $\alpha_{\bullet}$. However, we have seen (in \hyperref[cor:cone_controls_quasi_isomorphism]{Corollary~\ref*{cor:cone_controls_quasi_isomorphism}}) that exactness of $\cone(\alpha_{\bullet})$ means that $\alpha_{\bullet}$ is a quasi-isomorphism.
\end{proof}

\begin{corollary}
  Let
  \begin{equation*}
    \begin{tikzcd}
      \cdots
      \arrow[r]
      & M_{2,\bullet}
      \arrow[r]
      & M_{1,\bullet}
      \arrow[r]
      & M_{0,\bullet}
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
  be a complex in $\Ch_{\geq 0}(\Ch_{\geq 0}(\mathcal{A}))$ such that $H_{0}(M_{i, \bullet}) = 0$ for $i \neq 0$. Then $\Tot(M)$ is quasi-isomorphic to the sequence
  \begin{equation*}
    \begin{tikzcd}
      \cdots
      \arrow[r]
      & H_{0}(M_{2,\bullet})
      \arrow[r]
      & H_{0}(M_{1,\bullet})
      \arrow[r]
      & H_{0}(M_{0,\bullet})
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation*}
\end{corollary}
\begin{proof}
  For each $i$ we can write
  \begin{equation*}
    H_{0}(M_{i, \bullet}) = \coker d^{M_{i}}_{1}.
  \end{equation*}
  In particular, we have a double complex
  \begin{equation*}
    \begin{tikzcd}
      M_{0,3}
      \arrow[d]
      & M_{1,3}
      \arrow[d]
      \arrow[l]
      & M_{2,3}
      \arrow[d]
      \arrow[l]
      & M_{3,3}
      \arrow[d]
      \arrow[l]
      \\
      M_{0,2}
      \arrow[d]
      & M_{1,2}
      \arrow[d]
      \arrow[l]
      & M_{2,2}
      \arrow[d]
      \arrow[l]
      & M_{3,2}
      \arrow[d]
      \arrow[l]
      \\
      M_{0,1}
      \arrow[d]
      & M_{1,1}
      \arrow[d]
      \arrow[l]
      & M_{2,1}
      \arrow[d]
      \arrow[l]
      & M_{3,1}
      \arrow[d]
      \arrow[l]
      \\
      M_{0,0}
      \arrow[d]
      & M_{1,0}
      \arrow[l]
      \arrow[d]
      & M_{2,0}
      \arrow[l]
      \arrow[d]
      & M_{3,0}
      \arrow[l]
      \arrow[d]
      \\
      H_{0}(M_{0,\bullet})
      \arrow[d]
      & H_{0}(M_{1,\bullet})
      \arrow[d]
      \arrow[l]
      & H_{0}(M_{2,\bullet})
      \arrow[d]
      \arrow[l]
      & H_{0}(M_{3,\bullet})
      \arrow[l]
      \arrow[d]
      \\
      0
      & 0
      & 0
      & 0
    \end{tikzcd}
  \end{equation*}
  Flipping along the main diagonal, we have the following resolution.
  \begin{equation*}
    \begin{tikzcd}
      M_{\bullet, 2}
      \arrow[r]
      & M_{\bullet, 1}
      \arrow[r]
      & M_{\bullet, 0}
      \arrow[r]
      & H_{0}(M_{\bullet, \bullet})
    \end{tikzcd}
  \end{equation*}

  Now \hyperref[thm:resolutions_in_double_complexes_are_resolutions_of_total_complex]{Theorem~\ref*{thm:resolutions_in_double_complexes_are_resolutions_of_total_complex}} gives us the result we want.
\end{proof}

\subsection{Tensor-hom adjunction for chain complexes}
\label{ssc:tensor_hom_adjunction_for_chain_complexes}

In a general abelian category, there is no notion of a tensor product. However, in the category $\Rmod$, there \emph{is} a canonical tensor product, and we would like to be able to use homological algebra to understand it.

One of the fundamental properties of the tensor product (indeed, the property that justifies giving a universal construction the name tensor product) is that there is an adjunction between the tensor product and the hom functor. In this section, we will define that the tensor product on $\Rmod$ extends to a tensor product on $\Ch(\Rmod)$, and that this is left adjoint to an internal hom functor on $\Ch(\Rmod)$.

\begin{definition}[tensor product of chain complexes]
  \label{def:tensor_product_of_chain_complexes}
  Let $C_{\bullet}$, $D_{\bullet}$ be chain complexes in $\mathcal{A}$. We define the \defn{tensor product} of $C_{\bullet}$ and $D_{\bullet}$ by
  \begin{equation*}
    (C \otimes D)_{\bullet} = \Tot(C_{\bullet} \otimes D_{\bullet}),
  \end{equation*}
  where $\Tot(C_{\bullet} \otimes D_{\bullet})$ is the totalization of the double complex $C_{\bullet} \otimes D_{\bullet}$.
\end{definition}

The next step is to introduce the notion of the internal hom. The way to do this is the obvious one: we should have
\begin{equation*}
  \mathbf{Hom}(C_{\bullet}, D_{\bullet}) = \Tot(\Hom(C_{\bullet}, D_{\bullet})).
\end{equation*}
Unfortunately, even if $C_{\bullet}$ and $D_{\bullet}$ are bounded below, the double complex above will be second-quadrant rather than first, so our definition \hyperref[def:total_complex]{Definition~\ref*{def:total_complex}} of the total complex will not do. The reason for this mismatch is that, for double complexes which are not first quadrant, one must choose between the product and the coproduct, which no longer agree for infinite indexing sets.

In our case, the product will be the correct choice. For this reason, we make the following definition.

\begin{definition}[internal hom]
  \label{def:internal_hom}
  Let $C_{\bullet}$, $D_{\bullet}$ be chain complexes in $\mathcal{A}$. The \defn{internal hom functor} on $\Ch(\mathcal{A})$ is the functor
  \begin{equation*}
    \HOM_{\mathcal{A}}\colon \Ch(\mathcal{A})\op \times \Ch(\mathcal{A}) \to \Ch(\mathcal{A})
  \end{equation*}
  is defined by
  \begin{equation*}
    (\HOM_{\mathcal{A}})_{n} = \prod_{p+q=n} \Hom(C_{-p}, D_{q}),
  \end{equation*}
  and
  \begin{equation*}
    d = d^{C} + (-1)^{p} d^{D},
  \end{equation*}
  where the factor of $(-1)^{p}$ implements the sign trick.
\end{definition}

\begin{theorem}
  There is an isomorphism
  \begin{equation*}
    \Hom_{\mathcal{A}}(C_{\bullet} \otimes_{R} D_{\bullet}, E_{\bullet}) \cong \Hom_{\mathcal{A}}(C_{\bullet}, \HOM(D_{\bullet}, E_{\bullet})),
  \end{equation*}
  natural in everything.
\end{theorem}
\begin{proof}
  This is clear level-wise, since
  \begin{align*}
    \Hom((C_{\bullet} \otimes_{R} D_{\bullet})_{-n}, E_{m}) &\cong \Hom(\coprod_{p + q = -n}C_{p} \otimes_{R} D_{q}, E_{m}) \\
    &\cong \prod_{p+q=-n} \Hom(C_{p} \otimes_{R} D_{q}, E_{m}) \\
    &\cong \prod_{p+q=-n} \Hom(C_{p}, \Hom(D_{q}, E_{m})) \\
  \end{align*}
\end{proof}

\subsection{The Knneth formula}
\label{ssc:the_kunneth_formula}

This section takes place in $\Ab$. The same result holds in $\Rmod$, for $R$ a PID, but we will only need the $\Ab$ case.

\begin{theorem}[Knneth]
  \label{thm:kunneth_formula}
  Let $C_{\bullet}$, $D_{\bullet} \in \Ch(\Ab)$, and suppose that $C_{\bullet}$ is free, that is, that $C_{n}$ is free for all $n$. Then there is a short exact sequence
  \begin{equation*}
    \begin{tikzcd}[column sep=small]
      0
      \arrow[r]
      & \displaystyle\bigoplus\limits_{p+q=n} H_{p}(C_{\bullet}) \otimes H_{q}(D_{\bullet})
      \arrow[r, hook]
      & H_{n}(C_{\bullet} \otimes D_{\bullet})
      \arrow[r, two heads]
      & \displaystyle\bigoplus\limits_{p+q=n-1} \Tor_{1}(H_{p}(C_{\bullet}), H_{q}(D_{\bullet}))
      \arrow[r]
      & 0
    \end{tikzcd}.
  \end{equation*}
\end{theorem}
\begin{proof}
  Denote by $Z^{C}_{\bullet}$ the chain complex given level-wise by $Z^{C}_{n} = Z_{n}(C_{\bullet})$, and with trivial differentials. Define $B^{C}_{\bullet}$ and $H^{C}_{\bullet}$ similarly. Then, essentially by definition, we have the following short exact sequences of chain complexes.
  \begin{equation}
    \label{eq:seq1}
    \begin{tikzcd}
      0
      \arrow[r]
      & Z^{C}_{\bullet}
      \arrow[r, hook]
      & C_{\bullet}
      \arrow[r, two heads]
      & B^{C}[-1]_{\bullet}
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation}
  \begin{equation}
    \label{eq:seq2}
    \begin{tikzcd}
      0
      \arrow[r]
      & B^{C}_{\bullet}
      \arrow[r, hook]
      & Z^{C}_{\bullet}
      \arrow[r, two heads]
      & H^{C}_{\bullet}
      \arrow[r]
      & 0
    \end{tikzcd}
  \end{equation}

  We happily note that \hyperref[eq:seq2]{Sequence~\ref*{eq:seq2}}, taken level-wise, gives a free resolution of $H^{C}_{\bullet}$.

  Since \hyperref[eq:seq1]{Sequence~\ref*{eq:seq1}} is level-wise split, applying $- \otimes D$ takes the rows to short exact sequences. Since a short exact sequence of chain complexes is simply a sequence of chain complexes whose rows are short exact, the following sequence of chain complexes is short exact.
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & (Z^{C} \otimes D)_{\bullet}
      \arrow[r, hook]
      & (C \otimes D)_{\bullet}
      \arrow[r, two heads]
      & (B^{C}[-1] \otimes D)_{\bullet}
      \arrow[r]
      & 0
    \end{tikzcd}.
  \end{equation*}
  Thus, we get a long exact sequence on homology. 
  \begin{equation*}
    \begin{tikzcd}
      & \cdots
      \arrow[r]
      & H_{n+1}(B^{C}[-1] \otimes D)
      \arrow[dll, out=-22, in=157, looseness=1, overlay, "\delta" description]
      \\
      H_{n}(Z^{C} \otimes D)
      \arrow[r]
      & H_{n}(C \otimes D)
      \arrow[r]
      & H_{n}(B^{C}[-1] \otimes D)
      \arrow[dll, out=-22, in=157, looseness=1, overlay, "\delta" description]
      \\
      H_{n-1}(Z^{C} \otimes D)
      \arrow[r]
      & \cdots
    \end{tikzcd}
  \end{equation*}

  Consider several terms of the chain complex $(B^{C}[-1] \otimes D)_{\bullet}$.
  \begin{equation*}
    \begin{tikzcd}
      \cdots
      \arrow[r]
      & \displaystyle\bigoplus\limits_{p+q=n+1} B^{C}_{p-1} \otimes D_{q}
      \arrow[r]
      & \displaystyle\bigoplus\limits_{p+q=n} B^{C}_{p-1} \otimes D_{q}
      \arrow[r]
      & \cdots
    \end{tikzcd}
  \end{equation*}
  Because of the triviality of the differential of $B^{C}[-1]$, the above morphisms are a direct sum of morphisms
  \begin{equation*}
    \begin{tikzcd}
      B^{C}_{p-1} \otimes D_{q} 
      \arrow[r, "\id_{B} \otimes d^{D}"]
      & B^{C}_{p-1} \otimes D_{q-1} 
    \end{tikzcd}.
  \end{equation*}
  Hence, because $B^{C}_{p-1}$ is free, the homology of $(B^{C}[-1] \otimes D)_{\bullet}$ is
  \begin{align*}
    H_{n}(B[-1] \otimes D) &= \bigoplus_{p+q=n} B_{p-1} \otimes H_{n}(D) \\
    &= \bigoplus_{p+q=n=1} B_{p} \otimes H_{n}(D) \\
    &= (B^{C} \otimes H^{D})_{n-1}, \\
  \end{align*}
  where we have defined $H^{D}_{\bullet}$ in analogy with $H^{C}_{\bullet}$.

  Exactly the same reasoning as above shows that
  \begin{equation*}
    H_{n}(Z \otimes D) = (Z \otimes H^{D})_{n}.
  \end{equation*}

  Making these replacements in our long exact sequence gives us the following.
  \begin{equation*}
    \begin{tikzcd}
      & \cdots
      \arrow[r]
      & (B^{C} \otimes H^{D})_{n}
      \arrow[dll, out=-22, in=157, looseness=1, overlay, "\delta" description]
      \\
      (Z^{C} \otimes H^{D})_{n}
      \arrow[r]
      & H_{n}(C \otimes D)
      \arrow[r]
      & (B^{C} \otimes H^{D})_{n-1}
      \arrow[dll, out=-22, in=157, looseness=1, overlay, "\delta" description]
      \\
      (Z^{C} \otimes H^{D})_{n-1}
      \arrow[r]
      & \cdots
    \end{tikzcd}
  \end{equation*}

  A quick computation shows that
  \begin{equation*}
    \delta = \bigoplus_{p+q=n}(B^{C}_{p} \hookrightarrow Z_{p}^{C}) \otimes \id_{H^{D}_{q}}.
  \end{equation*}
  The kernel and cokernel of the connecting homomorphism are refreshingly familiar. The kernel corresponds precisely to our definition of $\Tor$ coming from the projective resolution from \hyperref[eq:seq2]{Sequence~(\ref*{eq:seq2})}, and the cokernel is the definition of $n$th homology.
  \begin{equation*}
    \begin{tikzcd}[column sep=small]
      \displaystyle\bigoplus\limits_{p+q=n}\Tor_{1}^{\Z}(H_{p}(C), H^{D}_{q})
      \arrow[d, equals]
      &&& \displaystyle\bigoplus\limits_{p+q=n} H_{p}(C) \otimes H_{q}^{D}
      \arrow[d, equals]
      \\
      \ker \delta
      \arrow[r, hook]
      & \displaystyle\bigoplus\limits_{p+q=n} B^{C}_{p} \otimes H^{D}_{q}
      \arrow[r, "\delta"]
      & \displaystyle\bigoplus\limits_{p+q=n} Z^{C}_{p} \otimes H^{D}_{q}
      \arrow[r, two heads]
      & \coker \delta
    \end{tikzcd}.
  \end{equation*}

  We can decorate our long exact sequence with these to find the following solid short exact sequence.
  \begin{equation*}
    \begin{tikzcd}[column sep=tiny]
      & 0
      \arrow[dr]
      \\
      && \displaystyle\bigoplus\limits_{p+q=n} H_{p}(C) \otimes H_{q}^{D}
      \arrow[dr, hook]
      \\
      \cdots
      \arrow[r, dashed]
      & (Z^{C} \otimes H^{D})_{n}
      \arrow[ur, dashed]
      \arrow[rr, dashed]
      && H_{n}(C \otimes D)
      \arrow[rr, dashed]
      \arrow[dr, two heads]
      && (B^{C} \otimes H^{D})_{n-1}
      \arrow[r, dashed]
      & \cdots
      \\
      &&&& \displaystyle\bigoplus\limits_{p+q=n-1}\Tor_{1}^{\Z}(H_{p}(C), H^{D}_{q})
      \arrow[ur, dashed]
      \arrow[dr]
      \\
      &&&&& 0
    \end{tikzcd}
  \end{equation*}

  Replacing $H^{C}_{n}$ by $H_{n}(C)$ and $H^{D}_{n}$ by $H_{n}(D)$, we find precisely the sequence we were looking for.
\end{proof}

\begin{proposition}
  The short exact sequence in the Knneth formula splits, but not canonically.
\end{proposition}

\begin{corollary}[universal coefficient theorem]
  \label{cor:universal_coefficient_theorem}
  Let $C_{\bullet}$ be a chain complex of free abelian groups, and let $A$ be an abelian group. Then there is a short exact sequence
  \begin{equation*}
    \begin{tikzcd}
      0
      \arrow[r]
      & H_{n}(C) \otimes A
      \arrow[r, hook]
      & H_{n}(C \otimes A)
      \arrow[r, two heads]
      & \Tor(H_{n-1}(C), A)
      \arrow[r]
      & 0
    \end{tikzcd}.
  \end{equation*}
\end{corollary}

%\begin{lemma}
%  \label{lemma:stepping_stone_to_kunneth}
%  Let $C_{\bullet}$ be a chain complex of free $R$-modules with trivial differential, and let $C'_{\bullet}$ be an arbitrary chain complex. Then there is an isomorphism
%  \begin{equation*}
%    \lambda\colon \bigoplus_{p + q = n} H_{p}(C_{\bullet}) \otimes H_{q}(C'_{\bullet}) \cong H_{n}(C_{\bullet} \otimes C'_{\bullet}).
%  \end{equation*}
%\end{lemma}
%\begin{proof}
%  We write
%  \begin{equation*}
%    Z_{p} = Z_{p}(C_{\bullet}),\qquad B_{p} = B_{p}(C_{\bullet}),\qquad Z'_{p} = Z_{p}(C'_{\bullet}),\qquad B'_{p} = B_{p}(C'_{\bullet}),
%  \end{equation*}
%  The sequence
%  \begin{equation*}
%    \begin{tikzcd}
%      0
%      \arrow[r]
%      & Z_{q}'
%      \arrow[r, hook]
%      & C_{q}'
%      \arrow[r, two heads]
%      & B_{q-1}'
%      \arrow[r]
%      & 0
%    \end{tikzcd}
%  \end{equation*}
%  is exact by definition, and since $Z_{p} = C_{p}$ is by assumption free, the sequence
%
%  By definition, $Z_{p} = C_{p}$ is free. Thus the sequence
%  \begin{equation*}
%    \begin{tikzcd}
%      0
%      \arrow[r]
%      & Z_{p} \otimes Z_{q}'
%      \arrow[r, hook]
%      & Z_{p} \otimes C_{q}'
%      \arrow[r, two heads]
%      & Z_{p} \otimes B_{q-1}'
%      \arrow[r]
%      & 0
%    \end{tikzcd}
%  \end{equation*}
%  is exact.
%
%  The differential of the tensor product complex $C_{\bullet} \otimes C'_{\bullet}$ is
%  \begin{align*}
%    d^{\mathrm{tot}}_{n} &= \sum_{i = 0}^{n} d^{C}_{i} \otimes \id_{C_{n-i}} + (-1)^{i} \id_{C_{i}} \otimes d^{C'}_{n-i} \\
%    &= \sum_{i = 0}^{n} (-1)^{i}\id_{C_{i}} \otimes d^{C}_{n-i}.
%  \end{align*}
%  Since $C_{i}$ is by assumption free, tensoring with it doesn't change homology, and we have
%  \begin{equation*}
%    Z_{n}(C_{\bullet} \otimes C'_{\bullet}) = \bigoplus_{p + q = n} Z_{p} \otimes Z'_{q},
%  \end{equation*}
%  and
%  \begin{equation*}
%    Z_{n}(C_{\bullet} \otimes C'_{\bullet}) = \bigoplus_{p + q = n} Z_{p} \otimes Z'_{q},
%  \end{equation*}
%
%\end{proof}

\end{document}
